{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"F5 Titan BIG-IP Next for Kubernetes Install Instructions on Nvidia BlueField-3","text":""},{"location":"#overview","title":"Overview","text":"<p>This guide will help you setup and install F5 BIG-IP Next for Kubernetes (BIG-IP Next for Kubernetes) on a platform with an Nvidia BlueField-3 DPU.</p> <p>The NVIDIA DOCA Framework enables rapidly creating and managing applications and services on top of the BlueField networking platform, leveraging industry-standard APIs. For more information please refer to DOCA Documentation.</p>"},{"location":"#big-ip-next-for-kubernetes-overview","title":"BIG-IP Next for Kubernetes Overview","text":"<p>BIG-IP Next for Kubernetes consists of two primary components:</p> <ol> <li>Data Plane: Handling traffic processing and rules.</li> <li>Control Plane: Monitors the Kubernetes cluster state and dynamically updates the Data Plane components.</li> </ol>"},{"location":"#data-plane-tmm","title":"Data Plane (TMM)","text":"<p>At the heart of Data Plane is the Traffic Management Microkernel (TMM). Which is responsible for processing network traffic entering and leaving the Kubernetes cluster, as well as integrating with the infrastructure beyond the cluster. The TMM and it's supporting components are deployed on the Nvidia BlueField-3 (BF3) DPU, fully utilizing its resources and offload engine, and freeing the CPU resources on the host for other tasks.</p>"},{"location":"#control-plane","title":"Control Plane","text":"<p>The Control Plane runs on the Host CPU worker node or generic workload worker nodes. It also acts as a controller for Kubernetes Gateway API</p>"},{"location":"#lab-setup","title":"Lab Setup","text":"<p>see prerequisites The following section describes implementation details for a lab setup.</p>"},{"location":"#deployment-strategy","title":"Deployment Strategy","text":"<p>For the purpose of this document, the diagram below illustrates a high-level deployment strategy for BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU. It assumes a specific Nvidia BlueField-3 networking configuration, utilizing Scalable Functions, Virtual Functions, and Open vSwitch (OVS) to connect the DPU, Host, and external uplink ports.</p> <p>This lab guide configures a single Kubernetes cluster that includes Hosts and DPUs as worker nodes. It assumes that one of the hosts will act as a Kuberentes controller (and allows workload deployment) while other hosts and DPUs join the cluster as worker nodes.</p> <p></p> <p>There are three main networks in the diagram:</p> <p>Management Network: The main underlay network for the Kubernetes cluster CNI and has the default gateway to reach internet. Both Host and the Nvidia BF-3 DPU are connected to this network and has addresses configured through DHCP.</p> <p>Internal Network: Represents an internal network path between the host deployed services and the BNK Dataplane deployed in the DPU. This network will be utilized to route ingress and egress traffic for workload deployed on the host through BNK Dataplane.</p> <p>External Network: The external network represents an \"external-to-the-cluster\" infrastructure network segment to reach external services/destinations.</p> <p>The Test Servers represent clients and servers that are reachable on different segments of the network.</p> <p>This could also be a single server connected to both Internal and External networks</p>"},{"location":"bnk-egress/","title":"BNK Egress","text":"<p>This lab guide assumes there will be two namespaces for tenant workload red and blue and that their egress/ingress is configured through VXLAN overlay. The following diagram shows tenant VXLAN config with focus on the red tenant knowing that blue tenant would be the same.</p> <p></p>"},{"location":"bnk-egress/#configure-vxlan-overlay","title":"Configure VXLAN overlay","text":"<p>To configure this we use <code>F5SPKVxlan</code> CR which establishes the overlay configurations to the host, a <code>F5SPKSnatpool</code> CR to set IP addresses used for SNATing egress traffic towards the network infrastructure, and <code>F5SPKEgress</code> CR that assigns the egress rules for namespace to specific VXLAN.</p> <p>The following <code>F5SPKVxlan</code> CRs configures two VXLANs red with VNI 100 and blue with VNI 200</p> <p>NOTE: The virtual function created on host on PF1 is assumed to be <code>enp83s0f1v0</code> in this guide. Replace every instance of <code>enp83s0f1v0</code> with the actual configured host-side virtual function.</p> <p>NOTE: The <code>remote_nodes</code> represent the host nodes only. Modify the list to properly reflect cluster node names and configured IP addresses as required. DPU nodes are not required here since workload is only expected on the host.</p> <p>Apply bnk-vxlan.yaml to create VXLAN tunnels for red and blue namespaces.</p> Show bnk-vxlan.yaml content YAML<pre><code>---\napiVersion: \"k8s.f5net.com/v1\"\nkind: F5SPKVxlan\nmetadata:\n  name: \"red\"\nspec:\n  name: \"red\"\n  port: 4789\n  key: 100\n  # Interface name on host nodes that is used for underlay.\n  # This is the previously configured Virtual Functionon PF1.\n  remote_interface_name: \"enp83s0f1v0\"\n  # Host nodes\n  remote_nodes:\n     # host node name in Kubernetes cluster.\n   - node_name: \"host-1\"\n     # Underlay IP address as configured on virtual function.\n     # Change if different in your infrastructure.\n     node_ip: \"192.168.20.41\"\n     # Mac address and IP addresses that will be assigned to the\n     # Host side VXLAN overlay interface.\n     peer_mac: \"00:f5:00:00:00:02\"\n     peerip_v4: \"198.18.100.1\"\n     peerip_v6: \"fd50::192:18:100:1\"\n   - node_name: \"host-2\"\n     node_ip: \"192.168.20.42\"\n     peer_mac: \"00:f5:00:00:00:03\"\n     peerip_v4: \"198.18.100.2\"\n     peerip_v6: \"fd50::192:18:100:2\"\n   - node_name: \"host-3\"\n     node_ip: \"192.168.20.43\"\n     peer_mac: \"00:f5:00:00:00:04\"\n     peerip_v4: \"198.18.100.3\"\n     peerip_v6: \"fd50::192:18:100:3\"\n  local_ips:\n   - \"192.168.20.201\"\n   - \"192.168.20.202\"\n   - \"192.168.20.203\"\n  selfip_v4s:\n   - \"198.18.100.201\"\n   - \"198.18.100.202\"\n   - \"198.18.100.203\"\n  prefixlen_v4: 24\n  selfip_v6s:\n   - \"fd50::192:18:100:201\"\n   - \"fd50::192:18:100:202\"\n   - \"fd50::192:18:100:203\"\n  prefixlen_v6: 112\n---\napiVersion: \"k8s.f5net.com/v1\"\nkind: F5SPKVxlan\nmetadata:\n  name: \"blue\"\nspec:\n  name: \"blue\"\n  port: 4789\n  key: 200\n  remote_interface_name: \"enp83s0f1v0\"\n  remote_nodes:\n   - node_name: \"host-1\"\n     node_ip: \"192.168.10.41\"\n     peer_mac: \"00:f5:01:00:00:02\"\n     peerip_v4: \"198.18.200.1\"\n     peerip_v6: \"fd50::192:18:200:1\"\n   - node_name: \"host-2\"\n     node_ip: \"192.168.10.42\"\n     peer_mac: \"00:f5:01:00:00:03\"\n     peerip_v4: \"198.18.200.2\"\n     peerip_v6: \"fd50::192:18:200:2\"\n   - node_name: \"host-3\"\n     node_ip: \"192.168.10.43\"\n     peer_mac: \"00:f5:01:00:00:04\"\n     peerip_v4: \"198.18.200.3\"\n     peerip_v6: \"fd50::192:18:200:3\"\n  local_ips:\n   - \"192.168.20.201\"\n   - \"192.168.20.202\"\n   - \"192.168.20.203\"\n  selfip_v4s:\n   - \"198.18.200.201\"\n   - \"198.18.200.202\"\n   - \"198.18.200.203\"\n  prefixlen_v4: 24\n  selfip_v6s:\n   - \"fd50::192:18:200:201\"\n   - \"fd50::192:18:200:202\"\n   - \"fd50::192:18:200:203\"\n  prefixlen_v6: 112\n</code></pre>"},{"location":"bnk-egress/#configure-snatpool","title":"Configure SNATPool","text":"<p>the <code>addressList</code> section is a list of lists of SNAT IP addresses that are assigned to each TMM. Since we have 3 TMMs here, we will create 3 lists one for each TMM.</p> <p>The SNAT addresess are unique per TMM. And they are picked based on the closest IP address to the nexthop (gateway or direct network) for intended destination.</p> <p>Apply bnk-snatpool.yaml to create SNAT addresses for workload in red and blue namespace.</p> Show bnk-snatpool.yaml content YAML<pre><code>---\napiVersion: \"k8s.f5net.com/v1\"\nkind: F5SPKSnatpool\nmetadata:\n  name: \"red-snat\"\nspec:\n  name: \"red-snat\"\n  addressList:\n    - - 192.168.10.221\n      - 2001::192:168:10:221\n      - 192.168.20.221\n      - 2001::192:168:20:221\n    - - 192.168.10.222\n      - 2001::192:168:10:222\n      - 192.168.20.222\n      - 2001::192:168:20:222\n    - - 192.168.10.223\n      - 2001::192:168:10:223\n      - 192.168.20.223\n      - 2001::192:168:20:223\n---\napiVersion: \"k8s.f5net.com/v1\"\nkind: F5SPKSnatpool\nmetadata:\n  name: \"blue-snat\"\nspec:\n  name: \"blue-snat\"\n  addressList:\n    - - 192.168.10.231\n      - 2001::192:168:10:231\n      - 192.168.20.231\n      - 2001::192:168:20:231\n    - - 192.168.10.232\n      - 2001::192:168:10:232\n      - 192.168.20.232\n      - 2001::192:168:20:232\n    - - 192.168.10.233\n      - 2001::192:168:10:233\n      - 192.168.20.233\n      - 2001::192:168:20:233\n</code></pre>"},{"location":"bnk-egress/#configure-f5spkegress-to-assign-tenants-egress-to-their-prespective-vxlan","title":"Configure <code>F5SPKEgress</code> to assign tenants egress to their prespective VXLAN","text":"<p>Now we can apply bnk-egress.yaml egress path in TMM with refernce to VXLAN and SNAT pools we just created.</p> Show bnk-egress.yaml content YAML<pre><code>---\napiVersion: k8s.f5net.com/v3\nkind: F5SPKEgress\nmetadata:\n  name: red-egress\nspec:\n  dualStackEnabled: true\n  snatType: SRC_TRANS_SNATPOOL\n  egressSnatpool: red-snat\n  pseudoCNIConfig:\n    namespaces:\n      - red\n    # Routing default pod interface eth0.\n    # Assumes pod does not have additional interfaces configured.\n    appPodInterface: eth0\n    # Name of VXLAN interface created on the host\n    # This is basically the same name as the VXLAN name in CR.\n    appNodeInterface: red\n    # Name of VXLAN interface on TMM which is the VXLAN CR name.\n    vlanName: red\n---\napiVersion: k8s.f5net.com/v3\nkind: F5SPKEgress\nmetadata:\n  name: blue-egress\nspec:\n  dualStackEnabled: true\n  snatType: SRC_TRANS_SNATPOOL\n  egressSnatpool: blue-snat\n  pseudoCNIConfig:\n    namespaces:\n      - blue\n    appPodInterface: eth0\n    appNodeInterface: blue\n    vlanName: blue\n</code></pre>"},{"location":"bnk-ingress/","title":"6. F5 BNK Ingress Configuration","text":"<p>BIG-IP Next for Kubernetes is also a controller for Kubernetes Gateway API. In the following example we will deploy a simple Nginx service in the red tenant namespace and advertise it's service to the infrastructure.</p> <p>The following diagram represents the service ingress path.</p> <p></p> <p>Apply the nginx-deployment.yaml file to deploy Nginx service in the red namespace.</p> Show content of nginx-deployment.yaml YAML<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  namespace: red\n  labels:\n    app: nginx-tcp\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx-tcp\n  template:\n    metadata:\n      labels:\n        app: nginx-tcp\n    spec:\n      containers:\n      - name: nginx-tcp\n        image: nginx:latest\n        ports:\n        - containerPort: 80\n        imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-app-svc\n  namespace: red\nspec:\n  ports:\n  - port: 80\n    targetPort: 80\n  selector:\n    app: nginx-tcp\n</code></pre> <p>Then expose the service to network by using Kubernetes Gateway API resources.</p> <p>Apply the nginx-gw-api.yaml file to expose the Nginx service on virtual server IP <code>192.168.10.100</code> port <code>80</code> as the diagram suggested.</p> Show content of nginx-gw-api.yaml YAML<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GatewayClass\nmetadata:\n  name: f5-gateway-class\n  namespace: red\nspec:\n  controllerName: \"f5.com/f5-gateway-controller\"\n  description: \"F5 BIG-IP Kubernetes Gateway\"\n---\napiVersion: gateway.k8s.f5net.com/v1\nkind: Gateway\nmetadata:\n  name: my-l4route-tcp-gateway\n  namespace: red\nspec:\n  addresses:\n  - type: \"IPAddress\"\n    value: 192.168.10.100\n  gatewayClassName: f5-gateway-class\n  listeners:\n  - name: nginx\n    protocol: TCP\n    port: 80\n    allowedRoutes:\n      kinds:\n      - kind: L4Route\n---\napiVersion: gateway.k8s.f5net.com/v1\nkind: L4Route\nmetadata:\n  name: l4-tcp-app\n  namespace: red\nspec:\n  protocol: TCP\n  parentRefs:\n  - name: my-l4route-tcp-gateway\n    sectionName: nginx\n  rules:\n  - backendRefs:\n    - name: nginx-app-svc\n      namespace: red\n      port: 80\n</code></pre> <p>Note</p> <p>For simplicity an IP address from the same subnet as the test server/client was used but this can be any IP address as long as the server/client is properly routed through one of the TMM's VLAN addresses.</p> <p>Note</p> <p>In this configuration, the TMM will use SNAT-AUTOMAP feature which means it will SNAT external client IP addresses when communicating with backend endpoints with TMM's own IP address not an address from snatpool.</p>"},{"location":"configure-bnk/","title":"Lab Configuration","text":"<p>The BIG-IP Next for Kubernetes dataplane component (TMM) executes all networking stack operations entirely in user space and connects to Scalable Function (SF) interfaces using the DPDK driver. The TMM's networking configuration is managed through Custom Resources (CRs), and we will utilize these resources to set up the installation as outlined in the lab diagram. </p>"},{"location":"configure-bnk/#configure-the-underlay-network","title":"Configure the Underlay Network","text":"<p>The underlay network consists of IP addresses directly connected to the physical network segments or infrastructure. These addresses are configured using the <code>F5SPKVlan</code> Custom Resource (CR).</p> <p>The <code>F5SPKVlan</code> resources below configure two untagged VLANs: - internal: Connected to the internal network segment. - external: Connected to the external network segment.</p> <p>The IPv4 and IPv6 address lists specify the underlay IP addresses reachable through these network segments. Each address from the list is assigned to one instance of TMM. The addresses list must include enough IP addresses enough for the number of TMM instances planned. For example if we have 3 DPU nodes, we require at least three IP addresses in the list.</p> <p>Example</p> <p>For example, if there are 3 DPU nodes in the deployment, you will need at least three IP addresses in the list.</p> <p>To apply this configuration, download, modify if needed, and apply the VLAN configuration file: bnk-vlans.yaml.</p> Show content of bnk-vlans.yaml YAML<pre><code>---\napiVersion: \"k8s.f5net.com/v1\"\nkind: F5SPKVlan\nmetadata:\n  name: internal\nspec:\n  name: internal\n  interfaces:\n    - \"1.2\"\n  tag: 0\n  selfip_v4s:\n    - 192.168.20.201\n    - 192.168.20.202\n    - 192.168.20.203\n  prefixlen_v4: 24\n  selfip_v6s:\n    - 2001::192:168:20:201\n    - 2001::192:168:20:202\n    - 2001::192:168:20:203\n  prefixlen_v6: 112\n  auto_lasthop: \"AUTO_LASTHOP_ENABLED\"\n  internal: true\n---\napiVersion: \"k8s.f5net.com/v1\"\nkind: F5SPKVlan\nmetadata:\n  name: external\nspec:\n  name:  external\n  interfaces:\n    - \"1.1\"\n  tag: 0\n  selfip_v4s:\n    - 192.168.10.201\n    - 192.168.10.202\n    - 192.168.10.203\n  prefixlen_v4: 24\n  selfip_v6s:\n    - 2001::192:168:10:201\n    - 2001::192:168:10:202\n    - 2001::192:168:10:203\n  prefixlen_v6: 112\n  auto_lasthop: \"AUTO_LASTHOP_ENABLED\"\n</code></pre> <p>Note</p> <ul> <li>A VLAN tag value of <code>0</code> (<code>tag: 0</code>) indicates an untagged VLAN. If tagging is required, replace <code>0</code> with the desired VLAN tag.</li> <li>Each interface can have only one untagged VLAN, while multiple tagged VLANs are allowed per interface.</li> <li>VLAN tags must be unique across all interfaces. The same VLAN tag cannot be assigned to more than one interface.</li> </ul> <p>When network interfaces, such as Scalable Functions (SFs), are connected to TMM (via the Network Attachment Definition), they are assigned index numbers based on the order in which they are configured. For example, interfaces are indexed as <code>1.1</code>, <code>1.2</code>, and so forth. In the <code>F5SPKVlan</code> configuration shown above, note the <code>interfaces</code> section referencing <code>1.1</code> and <code>1.2</code>.</p> <p>Mapping Interfaces in This Lab Guide</p> <p>This description provides a simplified overview of interface naming for clarity specific to this lab guide.</p> <ul> <li>Network Attachments:<ul> <li>Configured with the names <code>sf-internal</code> and <code>sf-external</code>.</li> </ul> </li> <li>Interface Mapping in <code>SPKInfrastructure</code> CR:<ul> <li>The <code>SPKInfrastructure</code> Custom Resource connects these interfaces as follows:   YAML<pre><code>networkAttachment:\n- name: default/sf-external\n- name: default/sf-internal\n</code></pre>   The order of the <code>networkAttachment</code> section determines the interface assignment:</li> <li><code>sf-external</code>: Assigned <code>1.1</code></li> <li><code>sf-internal</code>: Assigned <code>1.2</code></li> </ul> </li> </ul> <p>To verify the network configuration, check the status of the <code>F5SPKVlan</code> Custom Resources:</p> Bash Session<pre><code>host# kubectl get f5-spk-vlan\nNAME       READY   MESSAGE                                AGE\nexternal   True    CR config sent to all grpc endpoints   30h\ninternal   True    CR config sent to all grpc endpoints   30h\n</code></pre>"},{"location":"configure-bnk/#configure-calico-cni-to-allow-vxlan-from-bnk","title":"Configure Calico CNI to allow VXLAN from BNK","text":"<p>In this lab we will build VXLAN networks between the host node and the TMM to segregate tenants based on namespaces. Calico CNI as installed and configured in this lab will create rules to deny VXLAN traffic from different external sources than node list, and thus we need to explicitly allow the TMM VXLAN traffic to pass through host node to workload.</p> <p>In order to achieve that we need to patch calico's felixconfiguration to allow TMM's internal VLAN IP addresses.</p> <p>Tip</p> <p>Make sure the IP addresses match what is configured in the <code>F5SPKVlan</code> internal CR.</p> Bash Session<pre><code>host# kubectl patch felixconfiguration default --type='merge' -p='{\"spec\": {\"externalNodesList\": [\"192.168.20.201\", \"192.168.20.202\", \"192.168.20.203\"]}}'\n</code></pre>"},{"location":"install-bnk/","title":"Setup F5 BIG-IP Next for Kubernetes","text":"<p>The Kubernetes cluster is now ready for BIG-IP Next for Kubernetes installation.</p>"},{"location":"install-bnk/#1-taint-and-label","title":"1. Taint and Label","text":"<p>This lab assumes that DPU is dedicated for BNK installation. In order to prevent other general workload from scheduling on DPU node add the following taint.</p> <p>Note</p> <p>Replace  with DPU node name. Bash Session<pre><code>host# kubectl taint node &lt;dpu-node-name&gt; dpu=true:NoSchedule\n</code></pre> <p>In this lab, BNK Dataplane is going to be installed as a Kubernetes daemonset and scheduled on nodes with the label <code>app=f5-tmm</code>. Add the label to DPU node</p> Bash Session<pre><code>host# kubectl label node &lt;dpu-node-name&gt; app=f5-tmm\n</code></pre>"},{"location":"install-bnk/#2-kubernetes-namespaces","title":"2. Kubernetes Namespaces","text":"<p>The two main Kubernetes namespaces categories we use in this guide; Product, and Tenant namespaces.</p>"},{"location":"install-bnk/#product-namespaces","title":"Product Namespaces","text":"<p>Used to install core components of BNK. In this lab guide, the BIG-IP Next for Kubernetes product will use 2 namespaces</p> <ul> <li>f5-utils: All shared components for BIG-IP Next installation will use this namespace.</li> <li>default: Operator, BIG-IP Next control plane, and BIG-IP Next Dataplane components will use this namespace.</li> </ul> <p>Note</p> <p><code>default</code> namespace is available by default after Kubernetes installation. We need to create only the <code>f5-utils</code> namespace.</p> Create Product Namespaces<pre><code>host# kubectl create ns f5-utils\n</code></pre>"},{"location":"install-bnk/#tenant-namespaces","title":"Tenant Namespaces","text":"<p>F5 BNK watches specific Kubernetes namespaces for tenant services onboarding and configuring ingress/egress paths for these services.</p> <p>Note</p> <p>As of the writing of this document BNK requires the namespaces to be created to product installation. This requirement may change in future.</p> <p>In this guide we use two tenant namespaces, <code>red</code> and <code>blue</code>.</p> <p>Create required namespaces: Create Tenant Namespaces<pre><code>host# for ns in red blue; do kubectl create ns $ns; done\n</code></pre></p>"},{"location":"install-bnk/#3-authentication-with-f5-artifact-registery-far","title":"3. Authentication with F5 Artifact Registery (FAR)","text":"<p>To access BNK product images, you must authenticate with the F5 Artifact Registry (FAR). In this section, we will go through obtaining the authentication key and creating Kubernetes pull secret.</p> <ol> <li>Login to the MyF5.</li> <li>Navigate to Resources and click Downloads. </li> <li>Ensure account is selected then review the End User License Agreement and the Program Terms and click to check the box for <code>I have read and agreed to the terms of the End User License Agreement and Program Terms.</code> </li> <li>For Group select BIT-IP_Next, and Service Proxy for Kubernetes (SPK) in Product Line, and 1.9.2 for Product Version. </li> <li>Select f5-far-auth-key.tgz to download. </li> <li>Choose a location to download from and then download the file or copy link and download on the host linux. </li> <li>Copy the downloaded file <code>zxvf f5-far-auth-key.tgz</code> to host dpu-install directory and expand to see a file named <code>cne_pull_64.json</code>. That is the file that contains FAR authentication key.</li> <li>Use the far-kubernetes-secret.sh generate and install required Kubernetes pull secrets for FAR images.     Bash Session<pre><code>host# ./far-kubernetes-secret.sh\n</code></pre></li> <li>Login to FAR helm registery from host terminal where kubectl and helm commands are available     Bash Session<pre><code>host# cat cne_pull_64.json | helm registry login -u _json_key_base64 --password-stdin https://repo.f5.com\n</code></pre></li> </ol>"},{"location":"install-bnk/#4-cluster-wide-controller-requirements","title":"4. Cluster Wide Controller requirements","text":"<p>The Cluster Wide Controller (CWC) component manages license registeration and debug API. In this release there are some manual requirements that are needed. The steps also can be found in F5 guide to generate and install required certificates and ConfigMap.</p> <p>Generate certificates that will be used to communicate with CWC component API, by pulling the script from F5 repo then generating certs for the f5-utils namespace service as follows.</p> <ul> <li> <p>Pull and extract the chart containing cert generation scripts     Install required package \"make\"     Bash Session<pre><code>host# apt-get install -y make\n</code></pre></p> Example Output Bash Session<pre><code>host# apt-get install -y make\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nSuggested packages:\n  make-doc\nThe following NEW packages will be installed:\n  make\n0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 180 kB of archives.\nAfter this operation, 426 kB of additional disk space will be used.\nGet:1 http://archive.ubuntu.com/ubuntu jammy/main amd64 make amd64 4.3-4.1build1 [180 kB]\nFetched 180 kB in 1s (218 kB/s)\nSelecting previously unselected package make.\n(Reading database ... 80515 files and directories currently installed.)\nPreparing to unpack .../make_4.3-4.1build1_amd64.deb ...\nUnpacking make (4.3-4.1build1) ...\nSetting up make (4.3-4.1build1) ...\nProcessing triggers for man-db (2.10.2-1) ...\nScanning processes...\nScanning linux images...\n</code></pre> Bash Session<pre><code>host# helm pull oci://repo.f5.com/utils/f5-cert-gen --version 0.9.1\nhost# tar zxvf f5-cert-gen-0.9.1.tgz\n</code></pre> Example Output Bash Session<pre><code>host# helm pull oci://repo.f5.com/utils/f5-cert-gen --version 0.9.1\nPulled: repo.f5.com/utils/f5-cert-gen:0.9.1\nDigest: sha256:89d283a7b2fef651a29baf1172c590d45fbd1e522fa90207ecd73d440708ad34\nhost# tar zxvf f5-cert-gen-0.9.1.tgz\ncert-gen/\ncert-gen/LICENSE\ncert-gen/README.md\ncert-gen/tls_gen/\ncert-gen/tls_gen/tls-gen.md\ncert-gen/tls_gen/__pycache__/\ncert-gen/tls_gen/__pycache__/cli.cpython-39.pyc\ncert-gen/tls_gen/__pycache__/info.cpython-39.pyc\ncert-gen/tls_gen/__pycache__/__init__.cpython-39.pyc\ncert-gen/tls_gen/__pycache__/verify.cpython-39.pyc\ncert-gen/tls_gen/__pycache__/paths.cpython-39.pyc\ncert-gen/tls_gen/__pycache__/extension_gen.cpython-39.pyc\ncert-gen/tls_gen/__pycache__/gen.cpython-39.pyc\ncert-gen/tls_gen/cli.py\ncert-gen/tls_gen/extension_gen.py\ncert-gen/tls_gen/__init__.py\ncert-gen/tls_gen/paths.py\ncert-gen/tls_gen/info.py\ncert-gen/tls_gen/verify.py\ncert-gen/tls_gen/gen.py\ncert-gen/gen_cert.sh\ncert-gen/Chart.yaml\ncert-gen/openssl-cert-gen/\ncert-gen/openssl-cert-gen/client-cert.conf\ncert-gen/openssl-cert-gen/README.md\ncert-gen/openssl-cert-gen/csr.conf\ncert-gen/openssl-cert-gen/client-csr.conf\ncert-gen/openssl-cert-gen/server-cert.conf\ncert-gen/openssl-cert-gen/gen-yaml.sh\ncert-gen/openssl-cert-gen/gen-certs.sh\ncert-gen/basic/\ncert-gen/basic/profile.py\ncert-gen/basic/.DS_Store\ncert-gen/basic/openssl.cnf\ncert-gen/basic/grpc/\ncert-gen/basic/grpc/grpc-service.ext\ncert-gen/basic/grpc/validation-service.ext\ncert-gen/basic/grpc/f5-fqdn-resolver.ext\ncert-gen/basic/grpc/client.ext\ncert-gen/basic/grpc/grpc.mk\ncert-gen/basic/CertificateGenerator.md\ncert-gen/basic/Makefile\ncert-gen/common.mk\n</code></pre> </li> <li> <p>Generate the API self-signed certificates. At the end of this step the script would have generated to main secret files Generating <code>cwc-license-certs.yaml</code> and <code>cwc-license-client-certs.yaml</code></p> Bash Session<pre><code>host# sh cert-gen/gen_cert.sh -s=api-server -a=f5-spk-cwc.f5-utils -n=1\n</code></pre> Example Output Bash Session<pre><code>host# sh cert-gen/gen_cert.sh -s=api-server -a=f5-spk-cwc.f5-utils -n=1\n------------------------------------------------------------------\nService                   = api-server\nSubject Alternate Name    = f5-spk-cwc.f5-utils\nWorking directory         = /root/bnk-dpu-install/api-server-secrets\n------------------------------------------------------------------\nrm: cannot remove '/root/bnk-dpu-install/api-server-secrets': No such file or directory\nGenerating Secrets ...\npython3 profile.py regenerate --password \"\" \\\n--common-name f5net \\\n--client-alt-name client \\\n--server-alt-name f5-spk-cwc.f5-utils \\\n--days-of-validity 3650 \\\n--client-certs 1 \\\n--key-bits 2048 \nCreating 1 client extensions...\nWill generate a root CA and two certificate/key pairs (server and client)\n=&gt;  [openssl_req]\n.+.......+.....+.............+..+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...............+.+..+....+..............+......+...+.+..+.......+.....+...+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..............+...+.....+.+..+............+.......+...........+.........+.+............+..................+.....+....+.........+.....+.+...+.....+.+.........+...........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+..........+...........+.+.....+.+.....+....+......+.....+....+...+......+..+.......+..+..........+........+...+............+.......+.........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n-----\n=&gt;  [openssl_x509]\nWill generate leaf certificate and key pair for server\nUsing f5net for Common Name (CN)\nUsing parent certificate path at /root/bnk-dpu-install/cert-gen/basic/testca/cacert.pem\nUsing parent key path at /root/bnk-dpu-install/cert-gen/basic/testca/private/cakey.pem\nWill use RSA...\n=&gt;  [openssl_genpkey]\n..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+.........+..+......+............+.+..+....+........+.+.....+......+.........+.+......+..+...+.......+........+...+.......+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..........+...+...+..................+......+.+...............+..+......+.+......+..+......+.+.....+.+.....+.........+....+.........+..+....+..+...+.........+...+..................+............+....+......+.....+...+....+........+...+.......+...+...........+...+.+......+......+.........+.....+.+..+.............+..+......+......+......+....+......+...+..+..........+..+..........+.....+.+..+...+....+...+.....+....+.........+.....+......+....+...........+...+..........+...+.....+.........+.+.........+........+..........+...............+............+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+.........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...................+......+..+.+.....+.....................+...+..........+..+.........+....+...+..+...+...............+.......+........+...+.+.....+.........+.+.....+.+.........+...+.....+......+....+...+........+.....................+...+...+.............+.....+....+..+...+.+.....+...............+......+.+............+...+........+......+...+.+...........................+..............+...............+.+..+.+......+........+...+....+.....+.+..............+...+...+.............+.....+.+...+...+........+....+...+...+.....+......+...+......+.+...+..+......+...+.+.....+.+.....+........................+.........+.+......+..+.+..+.......+...+..+.......+.........+..+....+...............+...+........+............+.......+...+.....+...+.......+........+........................+.+........+.+.....+.+..+.......+......+..............+.+..+..........+...............+...+............+..+...+.......+......+...+..+.........+......+.............+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n=&gt;  [openssl_req]\n-----\n=&gt;  [openssl_ca]\nUsing configuration from /tmp/tmpnso_b2s4\n801B7E13897F0000:error:0700006C:configuration file routines:NCONF_get_string:no value:../crypto/conf/conf_lib.c:315:group=&lt;NULL&gt; name=unique_subject\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'f5net'\norganizationName      :ASN.1 12:'server'\nlocalityName          :ASN.1 12:'$$$$'\nCertificate is to be certified until Jan  5 18:51:43 2035 GMT (3650 days)\n\nWrite out database with 1 new entries\nData Base Updated\n=&gt;  [openssl_pkcs12]\nWill generate leaf certificate and key pair for client\nUsing f5net for Common Name (CN)\nUsing parent certificate path at /root/bnk-dpu-install/cert-gen/basic/testca/cacert.pem\nUsing parent key path at /root/bnk-dpu-install/cert-gen/basic/testca/private/cakey.pem\nWill use RSA...\n=&gt;  [openssl_genpkey]\n......+.+......+...+..+....+...+..+...+...+...+...............+............+............+.+.........+...+........+....+...........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+.+........+......+....+......+.....+.+.....+...+....+...........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+.+..+..........+..+.......+.........+......+.....+....+.....+.........+..........+..+.+........+..........+..+.........+....+..+...+.......+........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n.............+.........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+.........+.+...........+.+...+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*......+.......+..+..........+.........+.....+.......+.........+.....................+..+...+....+...+...+.....+.........+....+............+...+..............+......+.......+.....+...+.....................+.+..+......+.+....................+.+...+..+...............+...............+...+.+...+...........+.+...+......+......+......+..+............+...+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n=&gt;  [openssl_req]\n-----\n=&gt;  [openssl_ca]\nUsing configuration from /tmp/tmpnso_b2s4\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'f5net'\norganizationName      :ASN.1 12:'client'\nlocalityName          :ASN.1 12:'$$$$'\nCertificate is to be certified until Jan  5 18:51:44 2035 GMT (3650 days)\n\nWrite out database with 1 new entries\nData Base Updated\n=&gt;  [openssl_pkcs12]\nDone! Find generated certificates and private keys under ./result!\npython3 profile.py verify --client-certs 1 \nWill verify generated server certificate against the CA...\nWill verify server certificate against root CA\n/root/bnk-dpu-install/cert-gen/basic/result/server_certificate.pem: OK\nWill verify generated client certificate against the CA...\nWill verify client certificate against root CA\n/root/bnk-dpu-install/cert-gen/basic/result/client_certificate.pem: OK\nCopying secrets ...\nGenerating /root/bnk-dpu-install/cwc-license-certs.yaml\nGenerating /root/bnk-dpu-install/cwc-license-client-certs.yaml\n</code></pre> </li> <li> <p>Install secrets.</p> Bash Session<pre><code>host# kubectl apply -f cwc-license-certs.yaml -n f5-utils\nhost# kubectl apply -f cwc-license-client-certs.yaml -n f5-utils\n</code></pre> </li> <li> <p>Install the cwc-qkview-cm.yaml qkview config map file.     YAML<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n   name: cwc-qkview-cm\n   namespace: f5-utils\n</code></pre></p> </li> <li> <p>Install the cpcl-non-prod.yaml file that contains Json Key Set for license activation</p> YAML<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cpcl-key-cm\n  namespace: f5-utils\ndata:\n  jwt.key: |\n    {\n        \"keys\": [\n            {\n                \"kid\": \"v1\",\n                \"alg\": \"RS512\",\n                \"kty\": \"RSA\",\n                \"n\": \"26FcA1269RC6WNgRghIB7X772zTTts02NsqqN-_keSz5FVq1Ekg151NFu_53Tgz1FGsUiX4OUj-fOmuhK9uzkQv0zYZgXY6zmRo_9P-QgiycuFo7DWquDwEx4rZiMxXwlA9ER56s8PDdbXyfi3ceMV-aUQZFqMiU6gOTl5d7uMfskocPF4ja8ZRrLlXAzzRIR62VgbQa-3sT0_SZ4w1ME4eLzO1yb-Ex9va4JnwToVLSKfsZp6jYs9nvAGjZ8aN2_lzBx8uiZ1HQozGqcf0AEjU-FEY73Umvmyvzd4woQLQlbvyrRtL9_IkL2ySdQ9Znh2lXBdsmA9cLz4ZAYPdmvcjsyBaZmh15EOkczpVVan1_VVD4o28uLDpzQVDk_GNUYoZIRsuOzuKvzih0gkv-StH29umHbdKXrUhlMWM1zyaxz8gkHatn-g5uh70WwVwqPtfHaNrQ0fFiWoyGVOA_-XqsJWA9NLJorewp9HOVlyF8qzu5s9cFO4UGQas0fF2QR9QvhgCymK7iWbEFF3PXqUQTLfFsITgix3mmeXVYC3ODsPKvcFhNBqQxmeXM04N2XMLluz2qp581NUJygWAAfq7la0ylDJ1MtefyESD8SBs1at2a8kSEBJCdCtAuNX2q33JjxQP3AiGvHcKEAjd1uaNeSgdHC93BzT3u0gbh2Ok\",\n                \"e\": \"AQAB\",\n                \"x5c\": [\n                    \"MIIFqDCCBJCgAwIBAgIRAK+LbrS2gkaJSeoUQpMK0LswDQYJKoZIhvcNAQELBQAwgacxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApXYXNoaW5ndG9uMRowGAYDVQQKDBFGNSBOZXR3b3JrcywgSW5jLjEeMBwGA1UECwwVQ2VydGlmaWNhdGUgQXV0aG9yaXR5MTUwMwYDVQQDDCxGNSBTVEcgSXNzdWluZyBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgVEVFTSBWMTEQMA4GA1UEBwwHU2VhdHRsZTAeFw0yMTEwMTEyMzI0NTFaFw0yNjEwMTEwMDI0NTFaMIGBMQswCQYDVQQGEwJVUzETMBEGA1UECAwKV2FzaGluZ3RvbjEQMA4GA1UEBwwHU2VhdHRsZTEaMBgGA1UECgwRRjUgTmV0d29ya3MsIEluYy4xDTALBgNVBAsMBFRFRU0xIDAeBgNVBAMMF0Y1IFNURyBURUVNIEpXVCBBdXRoIHYxMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA26FcA1269RC6WNgRghIB7X772zTTts02NsqqN+/keSz5FVq1Ekg151NFu/53Tgz1FGsUiX4OUj+fOmuhK9uzkQv0zYZgXY6zmRo/9P+QgiycuFo7DWquDwEx4rZiMxXwlA9ER56s8PDdbXyfi3ceMV+aUQZFqMiU6gOTl5d7uMfskocPF4ja8ZRrLlXAzzRIR62VgbQa+3sT0/SZ4w1ME4eLzO1yb+Ex9va4JnwToVLSKfsZp6jYs9nvAGjZ8aN2/lzBx8uiZ1HQozGqcf0AEjU+FEY73Umvmyvzd4woQLQlbvyrRtL9/IkL2ySdQ9Znh2lXBdsmA9cLz4ZAYPdmvcjsyBaZmh15EOkczpVVan1/VVD4o28uLDpzQVDk/GNUYoZIRsuOzuKvzih0gkv+StH29umHbdKXrUhlMWM1zyaxz8gkHatn+g5uh70WwVwqPtfHaNrQ0fFiWoyGVOA/+XqsJWA9NLJorewp9HOVlyF8qzu5s9cFO4UGQas0fF2QR9QvhgCymK7iWbEFF3PXqUQTLfFsITgix3mmeXVYC3ODsPKvcFhNBqQxmeXM04N2XMLluz2qp581NUJygWAAfq7la0ylDJ1MtefyESD8SBs1at2a8kSEBJCdCtAuNX2q33JjxQP3AiGvHcKEAjd1uaNeSgdHC93BzT3u0gbh2OkCAwEAAaOB8jCB7zAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFLDdK33QD9FdLnrVFw+ZAkQUayxCMB0GA1UdDgQWBBQw/hNgf2AoJAF086NV7JGQj+B2NzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMHMGA1UdHwRsMGowaKBmoGSGYmh0dHA6Ly9jcmwtdGVlbS1zdGctb3JlLWY1LnMzLnVzLXdlc3QtMi5hbWF6b25hd3MuY29tL2NybC85ZGFmNGVlNy1iOGNkLTRiODEtOWE0MC00YjU3MGY0N2VhYWUuY3JsMA0GCSqGSIb3DQEBCwUAA4IBAQApzkSnsfuNSMHxVmL78pOQ+Rxkz1uYSVT0k1W45iufVmP0ixd8hFPcfb8u1RoHZ/58Gl52JPCudAB2sc4k/lHNT9cKL4w5F8LybB8uNJXikAqzu4HFobRYMiPtVQ7M8cFz5SgvGclxzBAbZzK5u5xZuGSkI6tG9l+D5JhW2LesRuQSBQniBgRhmtAJB7SXuZ2sNKsq04h7DWcpdjCSferymeCOLQcgy5F3ragKML8zyuNeKqtvZnUzJElKoU8G+Oo7MQXO7P5n6HX0NLfqqisv8CfSJUZTa1IRcfFUDJrcHtCgzingalzLLKzyelqR+YeY+j21jwVdnDVZIkFid2He\",\n                    \"MIIFDjCCAvagAwIBAgIBBTANBgkqhkiG9w0BAQsFADCBhDELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAldBMRgwFgYDVQQKEw9GNSBOZXR3b3JrcyBJbmMxHjAcBgNVBAsTFUNlcnRpZmljYXRlIEF1dGhvcml0eTEuMCwGA1UEAxMlRjUgSW50ZXJtZWRpYXRlIENlcnRpZmljYXRlIEF1dGhvcml0eTAeFw0xODEyMTMxOTU3NDlaFw0yODEyMTAxOTU3NDlaMIGnMQswCQYDVQQGEwJVUzETMBEGA1UECAwKV2FzaGluZ3RvbjEaMBgGA1UECgwRRjUgTmV0d29ya3MsIEluYy4xHjAcBgNVBAsMFUNlcnRpZmljYXRlIEF1dGhvcml0eTE1MDMGA1UEAwwsRjUgU1RHIElzc3VpbmcgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IFRFRU0gVjExEDAOBgNVBAcMB1NlYXR0bGUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC1zQVzFAkzJdDMk+blcmQ506+GhWZOoe32rSWpkztdH7nYHtE6ITx44nHErRLOXXcYsf8nQZyV2RiE5Gyxwvdg3ClC9XqfT702FxFWLPpD/I53cRZasYH3dFfdvDztEOlTsUrMfo7Bzfh7ZMaMkBczHno0DdP61lp6pfzsQRLSfdaWxLKkCxc3P2xDUyx9F7uX3lXsT042OuiZpoCrMumO53hmvw6ZtP6mH7d6dM7nhYhTIGxRMYrzEAHKl+JM0Jnaabwxw4UBMkxozxP+kLvDXrwLADjMslEuVeq1r7WwNa33y8aXfBUZpDCgJKfYvvPQIUD5d6ui0v7vwAQRgX/fAgMBAAGjZjBkMB0GA1UdDgQWBBSw3St90A/RXS561RcPmQJEFGssQjAfBgNVHSMEGDAWgBRz1uVFvQMN0SWZ8zjGfQLZ+vrt6TASBgNVHRMBAf8ECDAGAQH/AgEBMA4GA1UdDwEB/wQEAwIBhjANBgkqhkiG9w0BAQsFAAOCAgEABB8ygsfvpId2OPMh3jnTtEpfcJy80yu7vFVSMDQ/4xKTBSR0iFcCNmMJ8i4PL0E8RqFzcsUaG9Rq2uyiW71Y/+QiC0/xN8pXTua9zH1aYPLKTa62IB5Dnfax+QccNCehCAoJ/W4yVeY9/nHbSlYt8+eOMSdUJf/hcaPuHbLs6rJI9GHo9CNeBtWH0q+Xw3rRAXSrNXMg+CRE55JOVaDdzRUOEdf962Pd/MRN7+Sypyj2dR9rCJ/SKxf0HQr6NOGSAc3QbLun0bzew/0Nlww8UpCXV/ABiBFUBDvIhapMQqoErMuPm0CvqBdVCWafOa8qylHHOCkEUxTlxtk3WTwEI4RcrHnHVO4eIkstLe8+4HvKvCwXwoDlcms44lIzQpoPvVclkYYKH0d9GjY1dDSXxYeIm7aPeA6VutQoTd8ozKqZFjueESJB7JATC1q5PSiOhNIUr1d9Y7CbTpLWAl7ktJt5yZlcJBd3+5wztuCtwfQncjERRl8Sey3UuCjD836E7d4ZPldKUaJpDKpdzXIiiwDWCTL3G1iPBz+O1YyPAoQz6NFUsiHDnuIaGMfYLouf0ltuHTBwzcQbkFtH7PeY5Qwts617AQBy5lCJ3HLdJ9Hg3CwTXlBqFR+T/8vF0n6+AuE0ZFjmbJYJs0m4EObk0IOcex4ft33fPDEFWRJpHIs=\",\n                    \"MIIGFzCCA/+gAwIBAgIBAjANBgkqhkiG9w0BAQsFADCBsDEYMBYGA1UEChMPRjUgTmV0d29ya3MgSW5jMSEwHwYDVQQLExhGNSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxHTAbBgkqhkiG9w0BCQEWDnJvb3RAbG9jYWxob3N0MRAwDgYDVQQHEwdTZWF0dGxlMQswCQYDVQQIEwJXQTELMAkGA1UEBhMCVVMxJjAkBgNVBAMTHUY1IFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5MB4XDTIyMDcyMTIxMTQxOVoXDTMyMDcxODIxMTQxOVowgYQxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJXQTEYMBYGA1UEChMPRjUgTmV0d29ya3MgSW5jMR4wHAYDVQQLExVDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxLjAsBgNVBAMTJUY1IEludGVybWVkaWF0ZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCg/uLiu6BbzIfZnehoaBepLVVQIeEgCUPxg6iHNANvlRC3FTElriLIDLJ3zAktdd3B1CSttG8sS4z3TKmN1+C1GXJRUZ2TlPRSaPBIhPs3xGFRgwBTJpTknY2oZITpfoDegAIuZcvfF5rwbcvndo2SiCbNHFytD/tIjWOJ+2a8k4T+8tBjaBxRygPSQycR6dciFo1ARJKfeWQV7Jkc0nzOd0T6JYh2Fjkyzx2EJca1zx88etIhfRg7XMo3SWLF6XJEoMBGoTeAAnE3oo+7KbBmcMYfcWGkwa/bOrBL4GCE/u3OS9z0wIoZ8/ExdIvwvXfYCrHO7Q7mW/TL9VbnXQjqQiUu6KUaw7SnP2VnqOmWxZyeKGMPnp1CDNzljo97NUq+YBXWNUMrdG/ahemcKoLQj6X9VNXrv5pE2u4HdsTHsXLE+bf4gvhWSPOoJR06d77C0eppMGmseYTIphvrFYbOkyUqJ3QPeh0alyRERPwZo7KWXbiWwwTs2Ya0IP4ndVxfnPJCAdyLs5dZcCPwaSZcqKS+ruGq/NCdpv9c4qQlog4cgPJaLjdvyhgttHxKFb8gLwensE2R5j2EKk/eDVSMZH7DMxAMVCOwAXC7yU//jzxbM79oLXJKtGUOqI5Lqo14oBQ9GN9jMadH7QIf98WUKxoI9jG2b7RVTaVI63xUuQIDAQABo2YwZDAdBgNVHQ4EFgQUc9blRb0DDdElmfM4xn0C2fr67ekwHwYDVR0jBBgwFoAUvt3/76pNZ1Iqkujy1aWYEmZs4bowEgYDVR0TAQH/BAgwBgEB/wIBATAOBgNVHQ8BAf8EBAMCAYYwDQYJKoZIhvcNAQELBQADggIBAF8EmEr06Legji041di2NbG42oQ0Jgaa4du/V9jloUp/N4Qo5t1upDrSQcEGdkLCgvGBDUKHaZWdJSRtoW4OxlNUfOeU0HEkt24TjwrW08eXDjmmDnqYjhPheeVJNMP2e0+Kj5l3ncTWPD/aS8HtZUdggpU8L9Y8vg6Tl143dZaePQEj+FHghmReIkRoJ2GT/hXFp17p0lTTlcjdRv/zU/Yvtp7F0JL8tjkMqy1Al5xZYDWZznamKdMUT71ikMFVHOVRgK4L+mfLGjA3rHT/hTWQ6EentQmWwv1+wG8fvShBL48YwIFCW02VxD/qdJjgcLGJ3KB9xxO2IBGo99bT2D1xLXgnu5odLWMIB3rUR2hKJWRJI+haODXgE8x+vzHjMpQjkv0Ud0TdL1/ULnLkW0rIiksRQvtWNXfJe33MnMx+P+cQ8wvpCbtcLZVVlnpqRmfiN+YK9stvZS0RKOi10WdR2tJpYOUi/tJ4dQ/u7erYUrmu/onVbe0M8P8w4CuDxhyEC3s1Gk4wppe9SqZgM2Op4FaRBzvm7oxMg27RngZ6BdK5JBlDY4SVXm5YxGkKMupTjXMo98pSn4mxlr5o4MU0YKsrUWENBM+MPUKb2rRRq0yyy0xsnvr33hr9OIlRjYYr06MiGHM5YLKxsJm73YivOhZKAwhWEHSA6uZ7dCvA\",\n                    \"MIIGFzCCA/+gAwIBAgIBATANBgkqhkiG9w0BAQsFADCBsDEYMBYGA1UEChMPRjUgTmV0d29ya3MgSW5jMSEwHwYDVQQLExhGNSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxHTAbBgkqhkiG9w0BCQEWDnJvb3RAbG9jYWxob3N0MRAwDgYDVQQHEwdTZWF0dGxlMQswCQYDVQQIEwJXQTELMAkGA1UEBhMCVVMxJjAkBgNVBAMTHUY1IFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5MB4XDTE3MTAzMTIyMTQ1OVoXDTI3MTAyOTIyMTQ1OVowgYQxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJXQTEYMBYGA1UEChMPRjUgTmV0d29ya3MgSW5jMR4wHAYDVQQLExVDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxLjAsBgNVBAMTJUY1IEludGVybWVkaWF0ZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCg/uLiu6BbzIfZnehoaBepLVVQIeEgCUPxg6iHNANvlRC3FTElriLIDLJ3zAktdd3B1CSttG8sS4z3TKmN1+C1GXJRUZ2TlPRSaPBIhPs3xGFRgwBTJpTknY2oZITpfoDegAIuZcvfF5rwbcvndo2SiCbNHFytD/tIjWOJ+2a8k4T+8tBjaBxRygPSQycR6dciFo1ARJKfeWQV7Jkc0nzOd0T6JYh2Fjkyzx2EJca1zx88etIhfRg7XMo3SWLF6XJEoMBGoTeAAnE3oo+7KbBmcMYfcWGkwa/bOrBL4GCE/u3OS9z0wIoZ8/ExdIvwvXfYCrHO7Q7mW/TL9VbnXQjqQiUu6KUaw7SnP2VnqOmWxZyeKGMPnp1CDNzljo97NUq+YBXWNUMrdG/ahemcKoLQj6X9VNXrv5pE2u4HdsTHsXLE+bf4gvhWSPOoJR06d77C0eppMGmseYTIphvrFYbOkyUqJ3QPeh0alyRERPwZo7KWXbiWwwTs2Ya0IP4ndVxfnPJCAdyLs5dZcCPwaSZcqKS+ruGq/NCdpv9c4qQlog4cgPJaLjdvyhgttHxKFb8gLwensE2R5j2EKk/eDVSMZH7DMxAMVCOwAXC7yU//jzxbM79oLXJKtGUOqI5Lqo14oBQ9GN9jMadH7QIf98WUKxoI9jG2b7RVTaVI63xUuQIDAQABo2YwZDAdBgNVHQ4EFgQUc9blRb0DDdElmfM4xn0C2fr67ekwHwYDVR0jBBgwFoAUvt3/76pNZ1Iqkujy1aWYEmZs4bowEgYDVR0TAQH/BAgwBgEB/wIBATAOBgNVHQ8BAf8EBAMCAYYwDQYJKoZIhvcNAQELBQADggIBAGgXhdFaLvqYyzBTsc2jrfJWvnwwQztwkk++R2vR5Skwhy1ke5+fycmaiwERtOuqqjq0pJpFJiO61T0wlm/vF2HqsMMibvNgrSCvGurGyCdVTKahYNKqHWsevhhnqjoGWSlm7hgVz5wtGQoyImJMa3+qFvMtOZSFpHzSlteinLucPrA4EEuTNh1RjRNmq7J0oAl3+PG5bK5DpySOh4jX119G7P9VhX+aLVangYi9ZkBJgmx4tmsg7Caqg7RF0tIsnTdad9uI+WKty/vsXDntb8zzonTg59BhW3zMcT1p6Xutz4WyC0BHeculq+8LtLO0G2Dxxzeik/V9Z03mOW8bscjkPh5GcXtwTdSZiyh1ewGtyR0Jcj6vYqBLkXQtfX5JERuCuFcb15NE1Mr3V91kdJs1WPPY7fcwgPVEdBCa4Yo/FrwzoKuYqQIE8jnLEX+YOAcS8VS1eurPRl7v5ZZSMU2RnacvXL9TJ/Wk32KgUCOLjy2O3MmaPZLnasgDVQGXOdP4Q2pp7TRwjvR3GJvLCFQtvKBOZO35EhvF0AwAxi5PmTwSL3k3zdYlYADIyyo1YMhiS/FQueo06dtyShsoSPtmo7Jthus9xKxoyQVih11UdDieR9ZdikNRX805w1jc5O0DWFkq9AKDxLYKUkE/MxuvXzXls9RFHSwKMvzfxa0r\"\n                ],\n                \"use\": \"sig\"\n            }\n        ]\n    }\n</code></pre> </li> </ul>"},{"location":"install-bnk/#5-scalable-function-cni-binary","title":"5. Scalable Function CNI Binary","text":"<p>F5 created a CNI binary used here to move Scalable Function netdevice and RDMA devices inside of the dataplane container. This CNI is invoked by Multus delegation when attaching the Dataplane component to defined networks.</p> Bash Session<pre><code>host# helm pull oci://repo.f5.com/utils/f5-eowyn  --version 2.0.0-LA.1-0.0.11\nhost# tar zxvf f5-eowyn-2.0.0-LA.1-0.0.11.tgz\n</code></pre> Example Output Bash Session<pre><code>host# tar zxvf f5-eowyn-2.0.0-LA.1-0.0.11.tgz\nf5-eowyn/\nf5-eowyn/sf\nf5-eowyn/Chart.yaml\n</code></pre> <p>Note</p> <p>The <code>sf</code> CNI must be copied to all DPU nodes in the <code>/opt/cni/bin/</code> directory. For example:</p> Bash Session<pre><code>host# scp f5-eowyn/sf root@&lt;dpu-ip&gt;:/opt/cni/bin/\n</code></pre>"},{"location":"install-bnk/#6-configure-network-attachment-definitions","title":"6. Configure Network Attachment Definitions","text":"<p>Now that the CNI binary is installed we can configure Multus Network Attachment Definitions based on the configuration used in SR-IOV Device Plugin ConfigMap and using the <code>sf</code> CNI.\\ Apply the network-attachments.yaml configuration to the default namespace.</p> <p>This step will create two network attachment definitions for internal and external scalable functions as described in the lab diagram.</p>"},{"location":"install-bnk/#7-optional-install-grafana-and-prometheus","title":"7. (Optional) Install Grafana and Prometheus","text":"<p>Using Prometheus and Grafana to collect and visualize the metrics.</p>"},{"location":"install-bnk/#install-prometheus","title":"Install Prometheus","text":"<p>Prometheus example for this lab is defined in the prometheus.yaml file.</p> Show Prometheus deployment YAML<pre><code>---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: prometheus\nspec:\n  secretName: prometheus-secret\n  issuerRef:\n    group: cert-manager.io\n    kind: ClusterIssuer\n    name: bnk-ca-cluster-issuer\n  duration: 8640h\n  privateKey:\n    rotationPolicy: Always\n    encoding: PKCS1\n    algorithm: RSA\n    size: 4096\n  revisionHistoryLimit: 10\n  commonName: f5net.com\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: prometheus\n  managedFields:\n  - apiVersion: apps/v1\n  name: prometheus\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: prometheus\n  strategy:\n    rollingUpdate:\n      maxSurge: 1\n      maxUnavailable: 1\n    type: RollingUpdate\n  template:\n    metadata:\n      annotations:\n        prometheus.io/port: \"9090\"\n        prometheus.io/scrape: \"true\"\n      labels:\n        app: prometheus\n    spec:\n      containers:\n      - args:\n        - '--storage.tsdb.retention.time=6h'\n        - '--storage.tsdb.path=/prometheus'\n        - '--config.file=/etc/prometheus/prometheus.yaml'\n        image: prom/prometheus\n        imagePullPolicy: Always\n        name: prometheus\n        ports:\n        - containerPort: 9090\n          name: web\n          protocol: TCP\n        volumeMounts:\n        - mountPath: /etc/prometheus\n          name: prometheus-config-volume\n        - mountPath: /prometheus\n          name: prometheus-storage-volume\n        - name: prometheus-volume\n          mountPath: /etc/ssl\n          readOnly: true\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      volumes:\n      - configMap:\n          defaultMode: 420\n          name: prometheus-config\n        name: prometheus-config-volume\n      - name: prometheus-volume\n        secret:\n          secretName: prometheus-secret\n      - emptyDir: {}\n        name: prometheus-storage-volume\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: prometheus-config\n  namespace: default\ndata:\n  prometheus.yaml: |\n    global:\n      scrape_interval: 15s \n      evaluation_interval: 15s\n    scrape_configs:\n      - job_name: 'k8s_pod'\n        kubernetes_sd_configs:\n        - role: pod\n          namespaces:\n            names:\n            - default\n        relabel_configs:\n          - source_labels: [__meta_kubernetes_pod_label_metrics_prometheus, __meta_kubernetes_pod_container_port_number]\n            regex: publish;9090\n            action: keep\n          - source_labels: [__meta_kubernetes_pod_name]\n            action: replace\n            target_label: pod_name\n          - source_labels: [__meta_kubernetes_namespace]\n            action: replace\n            target_label: namespace\n        scheme: https\n        tls_config:\n          ca_file: \"/etc/ssl/ca.crt\"\n          cert_file: \"/etc/ssl/tls.crt\"\n          key_file: \"/etc/ssl/tls.key\"\n          insecure_skip_verify: true\n---\napiVersion: v1\nkind: Service\nmetadata:\n    name: prometheus-service\n    namespace: default\n    annotations:\n        prometheus.io/scrape: 'true'\n        prometheus.io/port:   '9090'\nspec:\n    selector:\n        app: prometheus\n    type: NodePort\n    ports:\n    - port: 8080\n      targetPort: 9090 \n      nodePort: 30000\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: prometheus-default\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - services\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - extensions\n  resources:\n  - ingresses\n  verbs:\n  - get\n  - list\n  - watch\n- nonResourceURLs:\n  - /metrics\n  verbs:\n  - get\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: prometheus-default\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: prometheus-default\nsubjects:\n- kind: ServiceAccount\n  name: default\n  namespace: default\n</code></pre> <p>Apply the file in default namespace</p> Bash<pre><code>host# kubectl apply -f prometheus.yaml\n</code></pre>"},{"location":"install-bnk/#install-grafana","title":"Install Grafana","text":"<p>Grafana example for this lab is defined in the grafana.yaml file.</p> Show Grafana deployment YAML<pre><code>---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: grafana\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: grafana\n  template:\n    metadata:\n      name: grafana\n      labels:\n        app: grafana\n    spec:\n      containers:\n      - name: grafana\n        image: grafana/grafana\n        ports:\n        - name: grafana\n          containerPort: 3000\n        resources:\n          limits:\n            memory: \"1Gi\"\n            cpu: \"1000m\"\n          requests:\n            memory: 500M\n            cpu: \"500m\"\n        volumeMounts:\n          - mountPath: /var/lib/grafana\n            name: grafana-storage\n          - mountPath: /etc/grafana/provisioning/datasources\n            name: grafana-datasources\n            readOnly: false\n      volumes:\n        - name: grafana-storage\n          emptyDir: {}\n        - name: grafana-datasources\n          configMap:\n              defaultMode: 420\n              name: grafana-datasources\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: grafana-datasources\ndata:\n  prometheus.yaml: |-\n    {\n        \"apiVersion\": 1,\n        \"datasources\": [\n            {\n               \"access\":\"proxy\",\n                \"editable\": true,\n                \"name\": \"prometheus\",\n                \"orgId\": 1,\n                \"type\": \"prometheus\",\n                \"url\": \"http://prometheus-service.default.svc:8080\",\n                \"version\": 1\n            }\n        ]\n    }\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: grafana\n  annotations:\n      prometheus.io/scrape: 'true'\n      prometheus.io/port:   '3000'\nspec:\n  selector:\n    app: grafana\n  type: NodePort\n  ports:\n    - port: 3000\n      targetPort: 3000\n      nodePort: 32000\n</code></pre> <p>Apply the file in default namespace</p> Bash<pre><code>host# kubectl apply -f grafana.yaml\n</code></pre>"},{"location":"install-bnk/#grafana-dashboard","title":"Grafana Dashboard","text":"<p>An example Grafana dashboard is provided in the grafana-dashboard.json file.</p> Show Grafana Dashboard JSON<pre><code>{\n  \"dashboard\": {\n    \"annotations\": {\n      \"list\": [\n        {\n          \"builtIn\": 1,\n          \"datasource\": {\n            \"type\": \"datasource\",\n            \"uid\": \"grafana\"\n          },\n          \"enable\": true,\n          \"hide\": true,\n          \"iconColor\": \"rgba(0, 211, 255, 1)\",\n          \"name\": \"Annotations &amp; Alerts\",\n          \"target\": {\n            \"limit\": 100,\n            \"matchAny\": false,\n            \"tags\": [],\n            \"type\": \"dashboard\"\n          },\n          \"type\": \"dashboard\"\n        }\n      ]\n    },\n    \"editable\": true,\n    \"fiscalYearStartMonth\": 0,\n    \"graphTooltip\": 0,\n    \"id\": 1,\n    \"links\": [],\n    \"panels\": [\n      {\n        \"collapsed\": true,\n        \"gridPos\": {\n          \"h\": 1,\n          \"w\": 24,\n          \"x\": 0,\n          \"y\": 0\n        },\n        \"id\": 38,\n        \"panels\": [\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"Bps\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 6,\n              \"x\": 0,\n              \"y\": 1\n            },\n            \"id\": 14,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"list\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"exemplar\": true,\n                \"expr\": \"rate(f5_ingress_system_disk_io{}[$__rate_interval])\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{device}}-{{direction}}\",\n                \"refId\": \"A\"\n              }\n            ],\n            \"title\": \"F5 Ingress Disk IO\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"iops\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 6,\n              \"x\": 6,\n              \"y\": 1\n            },\n            \"id\": 16,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"list\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"exemplar\": true,\n                \"expr\": \"rate(f5_ingress_system_disk_operation_time{}[$__rate_interval])\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{device}}-{{direction}}\",\n                \"refId\": \"A\"\n              }\n            ],\n            \"title\": \"F5 Ingress Disk Operation Time\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"prometheus\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                }\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 12,\n              \"y\": 1\n            },\n            \"id\": 12,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"list\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"exemplar\": true,\n                \"expr\": \"f5_ingress_system_cpu_time{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{cpu}}\",\n                \"refId\": \"A\"\n              }\n            ],\n            \"title\": \"F5 Ingress System CPU Time(Idle)\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"prometheus\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"decbits\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 17,\n              \"y\": 1\n            },\n            \"id\": 10,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"list\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"exemplar\": true,\n                \"expr\": \"f5_ingress_system_memory_usage{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"\",\n                \"refId\": \"A\"\n              }\n            ],\n            \"title\": \"F5 Ingress System Memory Usage\",\n            \"type\": \"timeseries\"\n          }\n        ],\n        \"title\": \"Controller\",\n        \"type\": \"row\"\n      },\n      {\n        \"collapsed\": true,\n        \"gridPos\": {\n          \"h\": 1,\n          \"w\": 24,\n          \"x\": 0,\n          \"y\": 1\n        },\n        \"id\": 37,\n        \"panels\": [\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                }\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 9,\n              \"w\": 5,\n              \"x\": 0,\n              \"y\": 2\n            },\n            \"id\": 4,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_0_cpu_usage_15mins{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_2_cpu_usage_15mins{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"F5 TMM CPU Usage 15 mins\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"decbits\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 9,\n              \"w\": 5,\n              \"x\": 5,\n              \"y\": 2\n            },\n            \"id\": 2,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_0_memory_used{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_2_memory_total{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"F5 TMM System Memory Usage\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"description\": \"\",\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 9,\n              \"w\": 5,\n              \"x\": 10,\n              \"y\": 2\n            },\n            \"id\": 33,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_1_counters_pkts_in{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_1_counters_pkts_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"F5 TMM Interface 1.1 Packets In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"description\": \"\",\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"decbits\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 9,\n              \"w\": 5,\n              \"x\": 15,\n              \"y\": 2\n            },\n            \"id\": 32,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_1_counters_bytes_in{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_1_counters_bytes_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"F5 TMM Interface 1.1 Bytes In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"decbits\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 0,\n              \"y\": 11\n            },\n            \"id\": 6,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"list\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_0_server_side_traffic_bytes_out{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_2_server_side_traffic_bytes_in{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"F5 TMM Network Bytes In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 5,\n              \"y\": 11\n            },\n            \"id\": 8,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_0_server_side_traffic_pkts_out{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_tmm_stat_2_server_side_traffic_pkts_in{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{name}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"F5 TMM Network Packets In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"decbits\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 10,\n              \"y\": 11\n            },\n            \"id\": 26,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_2_counters_bytes_in{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_2_counters_bytes_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"F5 TMM Interface 1.2 Bytes In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 15,\n              \"y\": 11\n            },\n            \"id\": 28,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_2_counters_pkts_in{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_interface_stat_1_2_counters_pkts_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"C\"\n              }\n            ],\n            \"title\": \"F5 TMM Interface 1.2 Pkts In/Out\",\n            \"type\": \"timeseries\"\n          }\n        ],\n        \"title\": \"TMM\",\n        \"type\": \"row\"\n      },\n      {\n        \"collapsed\": true,\n        \"gridPos\": {\n          \"h\": 1,\n          \"w\": 24,\n          \"x\": 0,\n          \"y\": 2\n        },\n        \"id\": 35,\n        \"panels\": [\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                }\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 0,\n              \"y\": 3\n            },\n            \"id\": 34,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"editorMode\": \"code\",\n                \"expr\": \"f5_tmm_fw_context_stat_1_packets_reject{}\",\n                \"legendFormat\": \"{{tmmID}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              }\n            ],\n            \"title\": \"ACL Rejected\",\n            \"type\": \"timeseries\"\n          }\n        ],\n        \"title\": \"ACL\",\n        \"type\": \"row\"\n      },\n      {\n        \"collapsed\": true,\n        \"gridPos\": {\n          \"h\": 1,\n          \"w\": 24,\n          \"x\": 0,\n          \"y\": 3\n        },\n        \"id\": 40,\n        \"panels\": [\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 0,\n              \"y\": 4\n            },\n            \"id\": 20,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_serverside_pkts_out{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_serverside_pkts_in{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Packets In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 6,\n              \"x\": 5,\n              \"y\": 4\n            },\n            \"id\": 24,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_clientside_pkts_in{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_clientside_pkts_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Client Packets In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 6,\n              \"x\": 11,\n              \"y\": 4\n            },\n            \"id\": 30,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_clientside_cur_conns{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_clientside_tot_conns{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{namespace}}-{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Connections\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"decbits\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 17,\n              \"y\": 4\n            },\n            \"id\": 18,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_serverside_bytes_in{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_blue_gatewayapi_l4_tcp_app_0_virtual_server_serverside_bytes_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Bytes In/Out\",\n            \"type\": \"timeseries\"\n          }\n        ],\n        \"title\": \"Blue Tenant\",\n        \"type\": \"row\"\n      },\n      {\n        \"collapsed\": true,\n        \"gridPos\": {\n          \"h\": 1,\n          \"w\": 24,\n          \"x\": 0,\n          \"y\": 4\n        },\n        \"id\": 39,\n        \"panels\": [\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 0,\n              \"y\": 5\n            },\n            \"id\": 41,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_serverside_pkts_out{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_serverside_pkts_in{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Packets In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 6,\n              \"x\": 5,\n              \"y\": 5\n            },\n            \"id\": 42,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_clientside_pkts_in{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_clientside_pkts_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Client Packets In/Out\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"short\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 6,\n              \"x\": 11,\n              \"y\": 5\n            },\n            \"id\": 43,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_clientside_cur_conns{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"P1809F7CD0C75ACF3\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_clientside_tot_conns{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{namespace}}-{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Connections\",\n            \"type\": \"timeseries\"\n          },\n          {\n            \"datasource\": {\n              \"type\": \"prometheus\",\n              \"uid\": \"P1809F7CD0C75ACF3\"\n            },\n            \"fieldConfig\": {\n              \"defaults\": {\n                \"color\": {\n                  \"mode\": \"palette-classic\"\n                },\n                \"custom\": {\n                  \"axisBorderShow\": false,\n                  \"axisCenteredZero\": false,\n                  \"axisColorMode\": \"text\",\n                  \"axisLabel\": \"\",\n                  \"axisPlacement\": \"auto\",\n                  \"barAlignment\": 0,\n                  \"barWidthFactor\": 0.6,\n                  \"drawStyle\": \"line\",\n                  \"fillOpacity\": 0,\n                  \"gradientMode\": \"none\",\n                  \"hideFrom\": {\n                    \"legend\": false,\n                    \"tooltip\": false,\n                    \"viz\": false\n                  },\n                  \"insertNulls\": false,\n                  \"lineInterpolation\": \"linear\",\n                  \"lineWidth\": 1,\n                  \"pointSize\": 5,\n                  \"scaleDistribution\": {\n                    \"type\": \"linear\"\n                  },\n                  \"showPoints\": \"auto\",\n                  \"spanNulls\": false,\n                  \"stacking\": {\n                    \"group\": \"A\",\n                    \"mode\": \"none\"\n                  },\n                  \"thresholdsStyle\": {\n                    \"mode\": \"off\"\n                  }\n                },\n                \"mappings\": [],\n                \"thresholds\": {\n                  \"mode\": \"absolute\",\n                  \"steps\": [\n                    {\n                      \"color\": \"green\",\n                      \"value\": null\n                    },\n                    {\n                      \"color\": \"red\",\n                      \"value\": 80\n                    }\n                  ]\n                },\n                \"unit\": \"decbits\"\n              },\n              \"overrides\": []\n            },\n            \"gridPos\": {\n              \"h\": 8,\n              \"w\": 5,\n              \"x\": 17,\n              \"y\": 5\n            },\n            \"id\": 44,\n            \"options\": {\n              \"legend\": {\n                \"calcs\": [],\n                \"displayMode\": \"table\",\n                \"placement\": \"bottom\",\n                \"showLegend\": true\n              },\n              \"tooltip\": {\n                \"hideZeros\": false,\n                \"mode\": \"single\",\n                \"sort\": \"none\"\n              }\n            },\n            \"pluginVersion\": \"11.5.2\",\n            \"targets\": [\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_serverside_bytes_in{}\",\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"A\"\n              },\n              {\n                \"datasource\": {\n                  \"type\": \"prometheus\",\n                  \"uid\": \"prometheus\"\n                },\n                \"editorMode\": \"code\",\n                \"exemplar\": true,\n                \"expr\": \"f5_tmm_virtual_server_stat_red_gatewayapi_l4_tcp_app_0_virtual_server_serverside_bytes_out{}\",\n                \"hide\": false,\n                \"interval\": \"\",\n                \"legendFormat\": \"{{tmmID}}-{{column}}\",\n                \"range\": true,\n                \"refId\": \"B\"\n              }\n            ],\n            \"title\": \"Virtual Server Bytes In/Out\",\n            \"type\": \"timeseries\"\n          }\n        ],\n        \"title\": \"Red Tenant\",\n        \"type\": \"row\"\n      }\n    ],\n    \"preload\": false,\n    \"refresh\": \"\",\n    \"schemaVersion\": 40,\n    \"tags\": [],\n    \"templating\": {\n      \"list\": []\n    },\n    \"time\": {\n      \"from\": \"now-1h\",\n      \"to\": \"now\"\n    },\n    \"timepicker\": {},\n    \"timezone\": \"\",\n    \"title\": \"F5 BNK Dashboard\",\n    \"uid\": null,\n    \"id\": null,\n    \"version\": 4,\n    \"weekStart\": \"\"\n  }\n}\n</code></pre> <p>Import the dashboard into Grafana</p> Bash<pre><code>host# kubectl -n grafana port-forward svc/grafana 3000:3000 &amp;\nhost# curl -X POST -H 'Content-Type: application/json' -d @grafana-dashboard.json http://admin:admin@localhost:3000/api/dashboards/db\n</code></pre>"},{"location":"install-bnk/#7-install-big-ip-next-for-kubernetes-operator-in-default-namespace","title":"7. Install BIG-IP Next for Kubernetes Operator in default namespace","text":"<p>The operator helps in installing BIG-IP Next for Kubernetes software. It requires two Custom Resources to be defined for the installation. <code>SPKInfrastructure</code> to describe dataplane infrastructure connections, and  <code>SPKInstance</code> which declares the state and configuration of the BNK product installation.</p>"},{"location":"install-bnk/#install-the-operator-chart","title":"Install the Operator chart","text":"Bash<pre><code>host# helm install orchestrator oci://repo.f5.com/charts/orchestrator \\\n        --version v0.0.25-0.0.96 \\\n        --set global.imagePullSecrets[0].name=far-secret \\\n        --set image.repository=repo.f5.com/images \\\n        --set image.pullPolicy=Always\n</code></pre>"},{"location":"install-bnk/#spkinfrastructure-custom-resource","title":"<code>SPKInfrastructure</code> Custom Resource","text":"<p><code>SPKInfrastructure</code> resource includes refernces to the Network Attachment Definitions created earlier, and the resources provisioned for these networks as configured in the SR-IOV device plugin section.</p> <p>The <code>SPKInfrastructure</code> resources is defined here infrastructure-cr.yaml.</p> Show SPKInfrastructure content YAML<pre><code>apiVersion: charts.k8s.f5net.com/v1alpha1\nkind: SPKInfrastructure\nmetadata:\n  name: bnk-dpu-infra\nspec:\n  networkAttachment:\n  - name: default/sf-external\n  - name: default/sf-internal\n  platformType: other\n  hugepages: true\n  sriovResources:\n    nvidia.com/bf3_p0_sf: \"1\"\n    nvidia.com/bf3_p1_sf: \"1\"\n  wholeClusterMode: \"enabled\"\n  calicoRouter: \"default\"\n  egress:\n    json:\n      ipPoolCidrInfo:\n        cidrList:\n        - name: vlan_cidr\n          value: \"192.168.20.0/24\"\n        - name: vlan_ipv6_cidr\n          value: \"2001::192:168:20:0/112\"\n        ipPoolList:\n        - name: default-ipv4-ippool\n          value: \"10.244.0.0/16\"\n</code></pre>"},{"location":"install-bnk/#install-required-otel-certificates","title":"Install required Otel Certificates","text":"<p>Otel service requires certificates to be installed with specific name. These certs will be used for TLS communication between Otel and Prometheus.</p> <p>Certificate requests for this lab can be found at otel-certs.yaml.</p> Show Otel Certificates content YAML<pre><code>---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: external-otelsvr\nspec:\n  subject:\n    countries:\n      - US\n    provinces:\n      - Washington\n    localities:\n      - Seattle\n    organizations:\n      - F5 Networks\n    organizationalUnits:\n      - PD\n  emailAddresses:\n    - clientcert@f5net.com\n  commonName: f5net.com\n  # SecretName is the name of the secret resource that will be automatically created and managed by this Certificate resource.\n  # It will be populated with a private key and certificate, signed by the denoted issuer.\n  secretName: external-otelsvr-secret\n  # IssuerRef is a reference to the issuer for this certificate.\n  issuerRef:\n    group: cert-manager.io\n    kind: ClusterIssuer\n    name: bnk-ca-cluster-issuer\n  # Lifetime of the Certificate is 360 days.\n  duration: 8640h\n  privateKey:\n    rotationPolicy: Always\n    encoding: PKCS1\n    algorithm: RSA\n    size: 4096\n  revisionHistoryLimit: 10\n---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: external-f5ingotelsvr\nspec:\n  subject:\n    countries:\n      - US\n    provinces:\n      - Washington\n    localities:\n      - Seattle\n    organizations:\n      - F5 Networks\n    organizationalUnits:\n      - PD\n  emailAddresses:\n    - clientcert@f5net.com\n  commonName: f5net.com\n  secretName: external-f5ingotelsvr-secret\n  issuerRef:\n    group: cert-manager.io\n    kind: ClusterIssuer\n    name: bnk-ca-cluster-issuer\n  duration: 8640h\n  privateKey:\n    rotationPolicy: Always\n    encoding: PKCS1\n    algorithm: RSA\n    size: 4096\n  revisionHistoryLimit: 10\n</code></pre> <p>Apply the certificates to the default namespace.</p> Bash<pre><code>host# kubectl apply -f otel-certs.yaml\n</code></pre>"},{"location":"install-bnk/#spkinstance-custom-resource","title":"<code>SPKInstance</code> Custom Resource","text":"<p>Download or copy the instance-cr-otel.yaml file and modify the <code>jwt:</code> with your license token obtained from MyF5.</p> Show SPKInstance content YAML<pre><code>apiVersion: charts.k8s.f5net.com/v1alpha1\nkind: SPKInstance\nmetadata:\n  name: bnk-dpu\n  namespace: default\nspec:\n  controller:\n    watchNamespace: red,blue\n  cwc:\n    persistence:\n      enabled: true\n      size: 20Gi\n    cpclConfig:\n      jwt: &lt;replace-with-jwt-token&gt;\n      operationMode: connected\n  global:\n    certmgr:\n      issuerRef:\n        group: cert-manager.io\n        kind: ClusterIssuer\n        name: bnk-ca-cluster-issuer\n    imagePullSecrets:\n    - name: far-secret\n    imageRepository: repo.f5.com/images\n    logging:\n      fluentbitSidecar:\n        enabled: true\n        fluentd:\n          host: f5-toda-fluentd.f5-utils.svc.cluster.local\n          port: \"54321\"\n  spkInfrastructure: bnk-dpu-infra\n  spkManifest: unused\n  afm:\n    enabled: true\n    pccd:\n      enabled: true\n      blob:\n        maxFwBlobSizeMb: \"512\"\n        maxNatBlobSizeMb: \"512\"\n  tmm:\n    replicaCount: 1\n    nodeAssign:\n      nodeSelector:\n        app: f5-tmm\n      tolerations:\n        - key: \"dpu\"\n          value: \"true\"\n          operator: \"Equal\"\n    palCPUSet: \"8-15\"\n    usePhysMem: true\n    tmmMapresHugepages: 6144\n    resources:\n      limits:\n        cpu: \"8\"\n        hugepages-2Mi: 13Gi \n        memory: 2Gi\n    debug:\n      enabled: true\n      resources:\n        limits:\n          cpu: 200m\n          memory: 100Mi\n        requests:\n          cpu: 200m\n          memory: 100Mi\n    xnetDPDKAllow:\n    - auxiliary:mlx5_core.sf.4,dv_flow_en=2\n    - auxiliary:mlx5_core.sf.5,dv_flow_en=2\n    blobd:\n      enabled: true\n      resources:\n        limits:\n          cpu: \"1\"\n          memory: \"1Gi\"\n        requests:\n          cpu: \"1\"\n          memory: \"1Gi\"\n    dynamicRouting:\n      enabled: false\n      configMapName: spk-bgp\n    tmrouted:\n      resources:\n        limits:\n          cpu: \"300m\"\n          memory: \"512Mi\"\n        requests:\n          cpu: \"300m\"\n          memory: \"512Mi\"\n    tmmRouting:\n      resources:\n        limits:\n          cpu: \"700m\"\n          memory: \"512Mi\"\n        requests:\n          cpu: \"700m\"\n          memory: \"512Mi\"\n    sessiondb:\n      useExternalStorage: \"true\"\n</code></pre> <p>Ensure that all pods in <code>default</code> and <code>f5-utils</code> namespaces are healthy. This can take up to 10 minutes.</p>"},{"location":"install-dpu/","title":"Install DPU Software","text":"<p>In the same directory <code>dpu-install</code> created in previous step.</p>"},{"location":"install-dpu/#1-download-bf-bundle","title":"1. Download BF Bundle","text":"<p>The BlueField bundle includes Operating System, Drivers, and DPU software tools. Nvidia DOCA download</p>"},{"location":"install-dpu/#2-create-bf-config","title":"2. Create bf config","text":"<p>The dpu-config.sh script will produce a BlueField install config file.</p> Show content of dpu-config.sh Bash<pre><code>#!/bin/bash -x\n\ngenerate_bluefield_config() {\n    bf_conf_template=$(cat &lt;&lt; 'EOFBFTEMPLATE'\n# UPDATE_DPU_OS - Update/Install BlueField Operating System (Default: yes)\nUPDATE_DPU_OS=\"yes\"\n\n# ubuntu_PASSWORD - Hashed password to be set for \"ubuntu\" user during BFB installation process.\n# Relevant for Ubuntu BFB only. (Default: is not set)\nubuntu_PASSWORD='{{PASSWORD}}'\n\n###############################################################################\n# Other misc configuration\n###############################################################################\n\n# MAC address of the rshim network interface (tmfifo_net0).\nNET_RSHIM_MAC={{NET_RSHIM_MAC}}\n\n# bfb_modify_os \u2013 SHELL function called after the file system is extracted on the target partitions.\n# It can be used to modify files or create new files on the target file system mounted under\n# /mnt. So the file path should look as follows: /mnt/&lt;expected_path_on_target_OS&gt;. This\n# can be used to run a specific tool from the target OS (remember to add /mnt to the path for\n# the tool).\n\nbfb_modify_os()\n{\n    # Set hostname\n    local hname=\"{{HOSTNAME}}\"\n    echo ${hname} &gt; /mnt/etc/hostname\n    echo \"127.0.0.1 ${hname}\" &gt;&gt; /mnt/etc/hosts\n\n    # Overwrite the tmfifo_net0 interface to set correct IP address\n    # This is relevant in case of multiple DPU system.\n    cat &lt;&lt; EOFNET &gt; /mnt/var/lib/cloud/seed/nocloud-net/network-config\nversion: 2\nrenderer: NetworkManager\nethernets:\n  tmfifo_net0:\n    dhcp4: false\n    addresses:\n      - {{IP_ADDRESS}}/{{IP_MASK}}\n  oob_net0:\n    dhcp4: true\nEOFNET\n\n    # Modules for kubernetes and DPDK\n    cat &lt;&lt; EOFMODULES &gt;&gt; /mnt/etc/modules-load.d/custom.conf\noverlay\nbr_netfilter\nvfio_pci\nEOFMODULES\n\n    # sysctl settings for kubernets\n    cat &lt;&lt; EOFSYSCTL &gt;&gt; /mnt/etc/sysctl.d/kubernetes.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOFSYSCTL\n\n    # Provision hugepages as part of grub boot\n    # Default to 2M hugepage size and provision 24.5 GB of hugepages\n    # TMM requires 1.5GB of hugepages per thread (CPU core) totaling\n    # 24GB to run on all 16 threads of the DPU.\n    local hpage_grub=\"default_hugepagesz=2MB hugepagesz=2M hugepages=12544\"\n    sed -i -E \"s|^(GRUB_CMDLINE_LINUX_DEFAULT=\\\")(.*)\\\"|\\1${hpage_grub}\\\"|\" /mnt/etc/default/grub\n    ilog \"$(chroot /mnt env PATH=$PATH /usr/sbin/grub-mkconfig -o /boot/grub/grub.cfg)\"\n\n    # Provision SF to be used by the TMM on each PF\n    # First clear out the current configurations for default SFs\n    # These default SFs do not have trust mode set to.\n    : &gt; /mnt/etc/mellanox/mlnx-sf.conf\n    # Then add new SFs with trust mode enabled.\n    for pciid in $(lspci -nD 2&gt; /dev/null | grep 15b3:a2d[26c] | awk '{print $1}')\n        do\n            cat &lt;&lt; EOFSF &gt;&gt; /mnt/etc/mellanox/mlnx-sf.conf\n/sbin/mlnx-sf --action create --enable-trust --device $pciid --sfnum 0 --hwaddr $(uuidgen | sed -e 's/-//;s/^\\(..\\)\\(..\\)\\(..\\)\\(..\\)\\(..\\).*$/02:\\1:\\2:\\3:\\4:\\5/')\n/sbin/mlnx-sf --action create --enable-trust --device $pciid --sfnum 1 --hwaddr $(uuidgen | sed -e 's/-//;s/^\\(..\\)\\(..\\)\\(..\\)\\(..\\)\\(..\\).*$/02:\\1:\\2:\\3:\\4:\\5/')\nEOFSF\n        done\n    # OVS changes\n    # 1. Change bridge names to follow internal document as sf_external for pf0\n    #    and sf_internal for pf1.\n    sed -i -E \"s|^(OVS_BRIDGE1=\\\")(.*)\\\"|\\1sf_external\\\"|\" /mnt/etc/mellanox/mlnx-ovs.conf\n    sed -i -E \"s|^(OVS_BRIDGE2=\\\")(.*)\\\"|\\1sf_internal\\\"|\" /mnt/etc/mellanox/mlnx-ovs.conf\n    # 2. Add the new created SFs, \"sfnum 1\" to their corresponding bridges.\n    #    Also include the virtual functions that are going to be created on host.\n    #    These vfs may not exist yet.\n    sed -i -E 's|^(OVS_BRIDGE1_PORTS=\")[^\"]*(\")|\\1p0 en3f0pf0sf1\\2|' /mnt/etc/mellanox/mlnx-ovs.conf\n    sed -i -E 's|^(OVS_BRIDGE2_PORTS=\")[^\"]*(\")|\\1p1 en3f1pf1sf1 pf1vf0\\2|' /mnt/etc/mellanox/mlnx-ovs.conf\n\n    # Cloud-init for upgrading containerd and runc\n    cat &lt;&lt; EOFCLOUDINIT &gt;&gt; /mnt/var/lib/cloud/seed/nocloud-net/user-data\nwrite_files:\n  - path: /etc/containerd/config.toml\n    content: |\n      version = 2\n      root = \"/var/lib/containerd\"\n      state = \"/run/containerd\"\n      oom_score = 0\n      [grpc]\n        max_recv_message_size = 16777216\n        max_send_message_size = 16777216\n      [debug]\n        address = \"\"\n        level = \"info\"\n        format = \"\"\n        uid = 0\n        gid = 0\n      [plugins]\n        [plugins.\"io.containerd.grpc.v1.cri\"]\n          sandbox_image = \"registry.k8s.io/pause:3.10\"\n          max_container_log_line_size = 16384\n          enable_unprivileged_ports = false\n          enable_unprivileged_icmp = false\n          enable_selinux = false\n          disable_apparmor = false\n          tolerate_missing_hugetlb_controller = true\n          disable_hugetlb_controller = true\n          image_pull_progress_timeout = \"5m\"\n          [plugins.\"io.containerd.grpc.v1.cri\".containerd]\n            default_runtime_name = \"runc\"\n            snapshotter = \"overlayfs\"\n            discard_unpacked_layers = true\n            [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes]\n              [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc]\n                runtime_type = \"io.containerd.runc.v2\"\n                runtime_engine = \"\"\n                runtime_root = \"\"\n                base_runtime_spec = \"/etc/containerd/cri-base.json\"\n                [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\n                  systemdCgroup = true\n                  binaryName = \"/usr/local/sbin/runc\"\n  - path: /var/tmp/setup-script.sh\n    permissions: '0755'\n    encoding: base64\n    content: |\n      IyEvYmluL2Jhc2gKClRNUERJUj0kKG1rdGVtcCAtZCkKL3Vzci9zYmluL250cHdhaXQgLXYKc3lzdGVtY3RsIHN0b3AgY29udGFpbmVyZCBrdWJlbGV0IGt1YmVwb2RzLnNsaWNlCnJtIC1yZiAvdmFyL2xpYi9jb250YWluZXJkLyoKcm0gLXJmIC9ydW4vY29udGFpbmVyZC8qCnJtIC1mIC91c3IvbGliL3N5c3RlbWQvc3lzdGVtL2t1YmVsZXQuc2VydmljZS5kLzkwLWt1YmVsZXQtYmx1ZWZpZWxkLmNvbmYKYXB0IC15IHB1cmdlIGt1YmVsZXQga3ViZWFkbSB8fCB0cnVlCmN1cmwgLS1vdXRwdXQtZGlyICR7VE1QRElSfSAtTE8gaHR0cHM6Ly9naXRodWIuY29tL29wZW5jb250YWluZXJzL3J1bmMvcmVsZWFzZXMvZG93bmxvYWQvdjEuMi4xL3J1bmMuYXJtNjQKaW5zdGFsbCAtbSA3NTUgJHtUTVBESVJ9L3J1bmMuYXJtNjQgL3Vzci9sb2NhbC9zYmluL3J1bmMKY3VybCAtLW91dHB1dC1kaXIgJHtUTVBESVJ9IC1MTyBodHRwczovL2dpdGh1Yi5jb20vY29udGFpbmVyZC9jb250YWluZXJkL3JlbGVhc2VzL2Rvd25sb2FkL3YxLjcuMjMvY29udGFpbmVyZC0xLjcuMjMtbGludXgtYXJtNjQudGFyLmd6CnRhciBDenh2ZiAvdXNyL2xvY2FsLyAke1RNUERJUn0vY29udGFpbmVyZC0xLjcuMjMtbGludXgtYXJtNjQudGFyLmd6Ci91c3IvbG9jYWwvYmluL2N0ciBvY2kgc3BlYyA+IC9ldGMvY29udGFpbmVyZC9jcmktYmFzZS5qc29uCmN1cmwgLUwgLW8gL2V0Yy9zeXN0ZW1kL3N5c3RlbS9jb250YWluZXJkLnNlcnZpY2UgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NvbnRhaW5lcmQvY29udGFpbmVyZC9tYWluL2NvbnRhaW5lcmQuc2VydmljZQpzeXN0ZW1jdGwgZGFlbW9uLXJlbG9hZApzeXN0ZW1jdGwgZW5hYmxlIC0tbm93IGNvbnRhaW5lcmQKbWtkaXIgLXAgL2V0Yy9hcHQva2V5cmluZ3MKY3VybCAtZnNTTCBodHRwczovL3BrZ3MuazhzLmlvL2NvcmU6L3N0YWJsZTovdjEuMjkvZGViL1JlbGVhc2Uua2V5IHwgZ3BnIC0tZGVhcm1vciAtbyAvZXRjL2FwdC9rZXlyaW5ncy9rdWJlcm5ldGVzLWFwdC1rZXlyaW5nLmdwZwphcHQtZ2V0IHVwZGF0ZSAmJiBhcHQtZ2V0IGluc3RhbGwgLXkga3ViZWxldCBrdWJlYWRtIGt1YmVjdGwKc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKc3lzdGVtY3RsIGVuYWJsZSAtLW5vdyBrdWJlbGV0CnJtIC1yZiAke1RNUERJUn0K\n\nruncmd:\n  - [ /var/tmp/setup-script.sh ]\nEOFCLOUDINIT\n}\n\n# bfb_post_install()\n# {\n#     log ===================== bfb_post_install =====================\n#     mst start\n#     mst_device=$(/bin/ls /dev/mst/mt*pciconf0 2&gt; /dev/null)\n#     # Setting SF enable per Nvidia documentation\n#     # Ref: https://docs.nvidia.com/doca/sdk/nvidia+bluefield+dpu+scalable+function+user+guide/index.html\n#     # and DPDK documentation\n#     # Ref: https://doc.dpdk.org/guides-21.11/nics/mlx5.html\n#     log \"Setting SF enable and BAR size for $mst_device\"\n#     for mst_device in /dev/mst/mt*pciconf*\n#     do\n#       log \"Disable port owner from ARM side for $mst_device\"\n#       mlxconfig -y -d $mst_device s PF_BAR2_ENABLE=0 PER_PF_NUM_SF=1 PF_TOTAL_SF=252 PF_SF_BAR_SIZE=12\n#     done\n# }\nEOFBFTEMPLATE\n)\n    read -p \"Enter the number of DPUs (default: 1): \" num_dpus\n    num_dpus=${num_dpus:-1}\n    read -p \"Enter the base hostname (default: dpu): \" base_hostname\n    base_hostname=${base_hostname:-dpu}\n    echo \"Enter the Ubuntu password minimum 12 characters (e.g. 'a123456AbCd!'): \"\n    # Password policy reference: https://docs.nvidia.com/networking/display/bluefielddpuosv490/default+passwords+and+policies#src-3432095135_DefaultPasswordsandPolicies-UbuntuPasswordPolicy\n    read -s clear_password\n    ubuntu_password=$(openssl passwd -1 \"${clear_password}\")\n    read -p \"Enter tmfifo_net IP subnet mask. Useful if you have more than 1 DPU (default: 30): \" ip_mask\n    ip_mask=${ip_mask:-30}\n    base_ip=${base_ip:-192.168.100}\n    read -p \"Do you want the DPU mgmt interface oob_net0 to use DHCP? (yes/no, default: yes): \" use_dhcp\n    use_dhcp=${use_dhcp:-yes}\n    if [[ \"$use_dhcp\" =~ ^([nN][oO]|[nN])$ ]]; then\n      read -p \"Enter the static IP for oob_net0: \" oob_ip\n      read -p \"Enter the subnet mask for oob_net0: \" oob_mask\n    fi\n\n    for ((i=1; i&lt;=num_dpus; i++)); do\n        hostname=\"${base_hostname}-${i}\"\n        ip_address=\"${base_ip}.$(( i + 1 ))\"\n        net_rshim_mac=00:1a:ca:ff:ff:1${i}\n        output_file=\"bfb_config_${hostname}.conf\"\n\n        echo \"Generating configuration for ${hostname} with IP ${ip_address}...\"\n        echo \"$bf_conf_template\" | sed -e \"s/{{HOSTNAME}}/${hostname}/g\" \\\n            -e \"s|{{PASSWORD}}|${ubuntu_password}|g\" \\\n            -e \"s/{{IP_ADDRESS}}/${ip_address}/g\" \\\n            -e \"s/{{IP_MASK}}/${ip_mask}/g\" \\\n            -e \"s/{{NET_RSHIM_MAC}}/${net_rshim_mac}/g\" \\\n            &gt; \"${output_file}\"\n        cat &lt;&lt; EOL\nConfiguration for ${hostname} is ${output_file}\nTo use the config run:\nbfb-install --rshim rshim$(( i - 1 )) --config ${output_file} --bfb &lt;bf-bundle-path&gt;\nEOL\ndone\n}\n\n\ngenerate_bluefield_config\n</code></pre> <p>Run the script to generate BlueField configuration.</p> Bash Session<pre><code>host# chmod +x dpu-config.sh &amp;&amp; ./dpu-config.sh\nEnter the number of DPUs (default: 1): 1\nEnter the base hostname (default: dpu): test-lab\nEnter the Ubuntu password minimum 12 characters (e.g. 'a123456AbCd!'): \nEnter tmfifo_net IP subnet mask. Useful if you have more than 1 DPU (default: 30): \nGenerating configuration for test-lab-1 with IP 192.168.100.2...\nConfiguration for test-lab-1 is bfb_config_test-lab-1.conf\nTo use the config run:\nbfb-install --rshim rshim0 --config bfb_config_test-lab-1.conf --bfb &lt;bf-bundle-path&gt;\n</code></pre> <p>The script produced a file named <code>bfb_config_test-lab-1.conf</code> based on input.</p>"},{"location":"install-dpu/#3-install-bf-bundle","title":"3. Install BF Bundle","text":"<p>Use <code>bfb-install</code> tool to install the bf-bundle. The following example assumes bf-bundle <code>bf-bundle-2.9.0-83_24.10_ubuntu-22.04_dev.20241121.bfb</code></p> Install bf-bundle on DPU<pre><code>host# bfb-install --rshim rshim0 --config bfb_config_test-lab-1.conf --bfb bf-bundle-2.9.0-83_24.10_ubuntu-22.04_dev.20241121.bfb\n</code></pre> <p>Follow status of DPU installation on <code>/dev/rshim0/misc</code> until DPU is reported ready.</p> Bash Session<pre><code>host# cat /dev/rshim0/misc \nDISPLAY_LEVEL   2 (0:basic, 1:advanced, 2:log)\nBF_MODE         Unknown\nBOOT_MODE       1 (0:rshim, 1:emmc, 2:emmc-boot-swap)\nBOOT_TIMEOUT    300 (seconds)\nUSB_TIMEOUT     40 (seconds)\nDROP_MODE       0 (0:normal, 1:drop)\nSW_RESET        0 (1: reset)\nDEV_NAME        pcie-0000:53:00.2\nDEV_INFO        BlueField-3(Rev 1)\nOPN_STR         N/A\nUP_TIME         9628(s)\nSECURE_NIC_MODE 0 (0:no, 1:yes)\nFORCE_CMD       0 (1: send Force command)\n---------------------------------------\n            Log Messages\n---------------------------------------\nINFO[PSC]: PSC BL1 START\nINFO[BL2]: start\nINFO[BL2]: boot mode (emmc)\nINFO[BL2]: VDD_CPU: 870 mV\nINFO[BL2]: VDDQ: 1120 mV\nINFO[BL2]: DDR POST passed\nINFO[BL2]: UEFI loaded\nINFO[BL31]: start\nINFO[BL31]: lifecycle GA Secured\nINFO[BL31]: runtime\nINFO[BL31]: MB ping success\nINFO[UEFI]: eMMC init\nINFO[UEFI]: eMMC probed\nINFO[UEFI]: UPVS valid\nINFO[UEFI]: PCIe enum start\nINFO[UEFI]: PCIe enum end\nINFO[UEFI]: UEFI Secure Boot (disabled)\nINFO[UEFI]: PK configured\nINFO[UEFI]: Redfish enabled\nINFO[UEFI]: DPU-BMC RF credentials not found\nINFO[UEFI]: exit Boot Service\nINFO[MISC]: Linux up\nINFO[MISC]: DPU is ready\n</code></pre>"},{"location":"install-dpu/#4-join-the-dpu-to-the-kubernetes-cluster","title":"4. Join the DPU to the Kubernetes cluster","text":""},{"location":"install-dpu/#41-get-the-join-token-from-controller-nodehost","title":"4.1. Get the join token from controller node/host","text":"Bash Session<pre><code>host# kubeadm token create --print-join-command\nkubeadm join 10.144.50.50:6443 --token ************************* --discovery-token-ca-cert-hash sha256:*************************\n</code></pre>"},{"location":"install-dpu/#42-join-the-kubernetes-cluster-on-the-dpu","title":"4.2. Join the Kubernetes cluster on the DPU","text":"Bash Session<pre><code>dpu# kubeadm join 10.144.50.50:6443 --token ************************* --discovery-token-ca-cert-hash sha256:*************************\n</code></pre>"},{"location":"install-host/","title":"2. Kubernetes Setup","text":"<p>Install Host Software</p> <p>Create a directory for example <code>dpu-install</code> to prepare for installation.</p> <p>Download the install-host.sh and modify the following default variables</p> Show content of install-host.sh Bash<pre><code>#!/bin/bash\n\nset -euo pipefail\n\nDEBUG=0\n\nif [[ ${DEBUG} -eq 1 ]]; then\n  set -x\nfi\n\n# defaults\n\n# Change the MGMT_NET variable to the management network CIDR\n# that will include both the host mgmt IP and DPU oob_net0 mgmt IP.\nMGMT_NET=\"10.144.0.0/16\"\n\n# Change this variable to point to the correct PF1 interface\n# name on the host.\nPF_INT=enp83s0f1np1\nVF_INT=${PF_INT/%np1/v0}\n\nDOCA_VERSION=2.9.1\nK8S_VERSION=\"1.29\"\nCONTAINERD_VERSION=\"1.7.23\"\nRUNC_VERSION=\"1.2.1\"\n\n\narch=$(uname -m)\ncase \"$arch\" in\nx86_64)\n    ARCH=\"amd64\"\n    ;;\naarch64)\n    ARCH=\"arm64\"\n    ;;\n*)\n    echo \"Unsupported system architecture: $arch\"\n    exit 1\n    ;;\nesac\n\n\ninstall_doca_all() {\n  for f in $( dpkg --list | awk '/doca/ {print $2}' ); do\n    echo \"Uninstalling package $f\"\n    apt remove --purge \"$f\" -y || true\n  done\n  /usr/sbin/ofed_uninstall.sh --force || true\n  apt-get -y autoremove\n  DOCA_URL=\"https://linux.mellanox.com/public/repo/doca/2.9.1/ubuntu22.04/$arch/\"\n  curl https://linux.mellanox.com/public/repo/doca/GPG-KEY-Mellanox.pub | gpg --yes --dearmor &gt; /etc/apt/trusted.gpg.d/GPG-KEY-Mellanox.pub\n  echo \"deb [signed-by=/etc/apt/trusted.gpg.d/GPG-KEY-Mellanox.pub] $DOCA_URL ./\" &gt; /etc/apt/sources.list.d/doca.list\n  apt-get update\n  apt-get -y install rshim\n  systemctl enable rshim --now\n  cat &lt;&lt; EONETPLAN &gt; /etc/netplan/50-tmfifo.yaml\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    tmfifo_net0:\n      dhcp4: no\n      addresses:\n        - 192.168.100.1/30\nEONETPLAN\n  chmod 600 /etc/netplan/50-tmfifo.yaml\n  netplan apply\n  sleep 5\n}\n\nconfigure_virtual_function() {\n  # TODO: add script to automatically discover PFs and adds a virtual\n  # function to pf1.\n  cat &lt;&lt; EOFVFCONF &gt; /etc/netplan/10-vf-config.yaml\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    $PF_INT:\n      dhcp4: no\n      virtual-function-count: 1\n    $VF_INT:\n      link: $PF_INT\n      dhcp4: no\n      addresses:\n        - 192.168.20.41/24\nEOFVFCONF\n  chmod 600 /etc/netplan/10-vf-config.yaml\n  netplan apply\n  sleep 5\n}\n\ninstall_runc() {\n    curl -LO https://github.com/opencontainers/runc/releases/download/v$RUNC_VERSION/runc.$ARCH\n    install -m 755 runc.$ARCH /usr/local/sbin/runc\n\n}\n\ninstall_containerd() {\n    mkdir -p /etc/containerd\n    curl -LO https://github.com/containerd/containerd/releases/download/v$CONTAINERD_VERSION/containerd-$CONTAINERD_VERSION-linux-$ARCH.tar.gz\n\n    tar Czxvf /usr/local/ containerd-$CONTAINERD_VERSION-linux-$ARCH.tar.gz\n\n    /usr/local/bin/ctr oci spec &gt; /etc/containerd/cri-base.json\n    cat &lt;&lt; EOL &gt; /etc/containerd/config.toml\nversion = 2\nroot = \"/var/lib/containerd\"\nstate = \"/run/containerd\"\noom_score = 0\n[grpc]\n  max_recv_message_size = 16777216\n  max_send_message_size = 16777216\n[debug]\n  address = \"\"\n  level = \"info\"\n  format = \"\"\n  uid = 0\n  gid = 0\n[plugins]\n  [plugins.\"io.containerd.grpc.v1.cri\"]\n    sandbox_image = \"registry.k8s.io/pause:3.10\"\n    max_container_log_line_size = 16384\n    enable_unprivileged_ports = false\n    enable_unprivileged_icmp = false\n    enable_selinux = false\n    disable_apparmor = false\n    tolerate_missing_hugetlb_controller = true\n    disable_hugetlb_controller = true\n    image_pull_progress_timeout = \"5m\"\n    [plugins.\"io.containerd.grpc.v1.cri\".containerd]\n      default_runtime_name = \"runc\"\n      snapshotter = \"overlayfs\"\n      discard_unpacked_layers = true\n      [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes]\n        [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc]\n          runtime_type = \"io.containerd.runc.v2\"\n          runtime_engine = \"\"\n          runtime_root = \"\"\n          base_runtime_spec = \"/etc/containerd/cri-base.json\"\n          [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\n            systemdCgroup = true\n            binaryName = \"/usr/local/sbin/runc\"\nEOL\n\n    curl -L -o /etc/systemd/system/containerd.service https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\n    systemctl daemon-reload\n    systemctl enable --now containerd\n}\n\ninstall_kubernetes_components() {\n    apt-get update &amp;&amp; apt-get install -y apt-transport-https ca-certificates curl gpg\n    mkdir -p /etc/apt/keyrings\n    curl -fsSL https://pkgs.k8s.io/core:/stable:/v$K8S_VERSION/deb/Release.key | gpg --yes --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n    echo \"deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v$K8S_VERSION/deb/ /\" | tee /etc/apt/sources.list.d/kubernetes.list\n    cat &lt;&lt; EOL &gt; /etc/sysctl.d/kubernetes.conf\nnet.bridge.bridge-nf-call-ip6tables=1\nnet.bridge.bridge-nf-call-iptables=1\nnet.ipv4.ip_forward=1\nnet.ipv6.conf.default.forwarding=1\nfs.inotify.max_user_watches=2099999999\nfs.inotify.max_user_instances=2099999999\nfs.inotify.max_queued_events=2099999999\nEOL\n    sysctl --system\n    echo \"br_netfilter\" &gt; /etc/modules-load.d/br_netfilter.conf\n    modprobe br_netfilter\n    swapoff -a\n    sed -i.backup '/swap/d' /etc/fstab\n    apt-get update\n    apt-get install -y kubelet kubeadm kubectl\n    apt-mark hold kubelet kubeadm kubectl\n    systemctl enable --now kubelet\n}\n\n\ninit_kubernetes() {\n    kubeadm init --pod-network-cidr=10.244.0.0/16\n    mkdir -p $HOME/.kube\n    cp -f /etc/kubernetes/admin.conf $HOME/.kube/config\n    kubectl get node\n    echo \"Installing Calico CNI ...\"\n    kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.29.1/manifests/tigera-operator.yaml\n    cat &lt;&lt; EOFCALICO | kubectl apply -f -\n---\napiVersion: operator.tigera.io/v1\nkind: Installation\nmetadata:\n  name: default\nspec:\n  calicoNetwork:\n    ipPools:\n    - name: default-ipv4-ippool\n      blockSize: 26\n      cidr: 10.244.0.0/16\n      encapsulation: VXLANCrossSubnet\n      natOutgoing: Enabled\n      nodeSelector: all()\n    bgp: Disabled\n    nodeAddressAutodetectionV4:\n      cidrs:\n      - \"$MGMT_NET\"\n---\napiVersion: operator.tigera.io/v1\nkind: APIServer\nmetadata:\n  name: default\nspec: {}\nEOFCALICO\n    # Wait for Calico system to start installation and create the calico-system namespace.\n    sleep 30\n    kubectl wait --for=condition=Ready pods --all --all-namespaces --timeout=300s\n    kubectl taint nodes --all node-role.kubernetes.io/control-plane- || true\n    kubectl get pod --all-namespaces\n    echo \"Adding node annotation for internal static route\"\n    for node in $(kubectl get node -o name); do\n      kubectl annotate --overwrite $node 'k8s.ovn.org/node-primary-ifaddr={\"ipv4\":\"192.168.20.41\"}'\n    done\n    kubectl apply -f https://raw.githubusercontent.com/k8snetworkplumbingwg/multus-cni/master/deployments/multus-daemonset-thick.yml\n    kubectl wait --for=condition=Ready pods --all --all-namespaces --timeout=300s\n    cat &lt;&lt; 'EOSRIOVCONF' | kubectl apply -f -\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: sriovdp-config\n  namespace: kube-system\ndata:\n  config.json: |\n    {\n        \"resourceList\": [\n            {\n                 \"resourceName\": \"bf3_p0_sf\",\n                  \"resourcePrefix\": \"nvidia.com\",\n                  \"deviceType\": \"auxNetDevice\",\n                  \"selectors\": [{\n                      \"vendors\": [\"15b3\"],\n                      \"devices\": [\"a2dc\"],\n                      \"pciAddresses\": [\"0000:03:00.0\"],\n                      \"pfNames\": [\"p0#1\"],\n                      \"auxTypes\": [\"sf\"]\n                  }]\n              },\n              {\n                 \"resourceName\": \"bf3_p1_sf\",\n                  \"resourcePrefix\": \"nvidia.com\",\n                  \"deviceType\": \"auxNetDevice\",\n                  \"selectors\": [{\n                      \"vendors\": [\"15b3\"],\n                      \"devices\": [\"a2dc\"],\n                      \"pciAddresses\": [\"0000:03:00.1\"],\n                      \"pfNames\": [\"p1#1\"],\n                      \"auxTypes\": [\"sf\"]\n                  }]\n              }\n        ]\n    }\nEOSRIOVCONF\n    kubectl apply -f https://raw.github.com/k8snetworkplumbingwg/sriov-network-device-plugin/master/deployments/sriovdp-daemonset.yaml\n    kubectl patch daemonset kube-sriov-device-plugin -n kube-system --type='json' -p='[{\"op\": \"add\", \"path\": \"/spec/template/spec/tolerations\", \"value\": [{\"effect\": \"NoSchedule\", \"operator\": \"Exists\"}]}]'\n\n    helm repo add jetstack https://charts.jetstack.io --force-update\n    helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --version v1.16.1 --set crds.enabled=true --set featureGates=ServerSideApply=true\n    cat &lt;&lt; 'EOFCERTMGRCONF' | kubectl apply -f -\n---\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n    name: selfsigned-cluster-issuer\nspec:\n    selfSigned: {}\n---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n    name: bnk-ca\n    namespace: cert-manager\nspec:\n    isCA: true\n    commonName: bnk-ca\n    secretName: bnk-ca\n    issuerRef:\n        name: selfsigned-cluster-issuer\n        kind: ClusterIssuer\n        group: cert-manager.io\n---\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n    name: bnk-ca-cluster-issuer\nspec:\n  ca:\n    secretName: bnk-ca\nEOFCERTMGRCONF\n\n    kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.2.0/experimental-install.yaml\n    kubectl wait --for=condition=Ready pods --all --all-namespaces --timeout=300s\n\n}\n\n\nexport DEBIAN_FRONTEND=noninteractive\n\ntrap 'unset DEBIAN_FRONTEND' ERR EXIT\n\n# 1. Install DOCA software\ninstall_doca_all\n\n# 2. Install runc\ninstall_runc\n\n# 3. Install containerd\ninstall_containerd\n\n# 4. Install and init Kubernetes\ninstall_kubernetes_components\n\n# 5. Init Kubernetes Controller node and install required services.\ninit_kubernetes\n\n# 6. Configure virtual function on PF1\nconfigure_virtual_function\n\necho \"======================\"\necho \"Installation complete.\"\n\nunset DEBIAN_FRONTEND\n</code></pre> Variable Description Default <code>MGMT_NET</code> Management Network CIDR for host and DPU <code>10.144.0.0/16</code> <code>PF_INT</code> Host PF 1 netdev name. This is the port connected to Internal network enp83s0f1np1 <p>Note</p> <p>Only use PF 1 for the variable <code>PF_INT</code>. Do not use <code>np0</code>.</p> <p>Then run the script on the host machine.</p> Host Software Installation<pre><code>host# chmod +x install-host.sh &amp;&amp; ./install-host.sh\n</code></pre> <p>Note</p> <p>The script initalizes Kubernetes cluster also using <code>kubeadm init</code> it should only run on Controller node.</p>"},{"location":"prereq/","title":"Prerequisites","text":""},{"location":"prereq/#software","title":"Software","text":"<p>This lab guide will walk you through setup of Kubernetes cluster using kubeadm. The guide assumes that you have Ubuntu 22.04 installed on the host machine and the Nvidia BlueField-3 is running in the default DPU mode, and uplink port links set to <code>ETH</code>.</p> <p>Note</p> <p>The following table is provided as guidance if software installation is prefered outside of this guide.</p> Software Version Node/Selector Installed in this Guide Reference DOCA 2.8+ Host Yes NVIDIA DOCA Installation Guide for Linux BF Bundle BFB 2.8+ DPU Yes Nvidia DOCA Downloads Kubelet 1.29+ Host and DPU Yes Kubernetes Kubeadm guide Kubeadm 1.29+ Host and DPU Yes Kubectl 1.29+ Host and DPU Yes Containerd 1.7.22+ Host and DPU Yes Containerd Getting Started cert-manager 1.16.1+ Host and DPU Yes Cert-manager installation SR-IOV Device Plugin 3.7.0+ DPU Yes SR-IOV Device Plugin Multus 4.1.0+ Host and DPU Yes Multus quick install Calico 3.28.1+ Host and DPU Yes Calico"},{"location":"prereq/#hardware","title":"Hardware","text":"<p>This lab guide was tested on the following hardware configurations:</p> <p>Note</p> <p>The hardware list below serves as example based on tested platforms. Only one of those or any other Nvidia DPU-3 compatible system is required for this guide.</p> Vendor Model CPU Architecture # of Cores RAM Storage Dell Poweredge R750 x86_64 96 512 GB 21 TB Supermicro LB26-R16R12 aarch64 96 512 GB 20 TB Supermicro HGX AS-4125GS-TNRT x86_64 128 768 GB 12 TB Supermicro MGX ARS-111GL-NHR aarch64 72 512 GB 1.5 TB"},{"location":"prereq/#aux-cable","title":"AUX Cable","text":"<p>HGX : Part Numbers - CBL-PWEX-1040 and CBL-PWEX-1148-20</p> <p>MGX : Part Number - CBL-PWEX-1040</p> <p>Dell : Amazon.com: BestParts New 12Pin to 8+8 Pin GPU Power Cable Compatible with Dell PowerEdge R750 R750XS R7525 Server 16inches DPHJ8 : Electronics</p>"},{"location":"prereq/#network-optics","title":"Network Optics","text":"<p>The following network optics were tested on the DPU ports.</p> <p>MGX &amp; HGX : 200Gb SR4 Ethernet Only - NVIDIA Ethernet MMA1T00-VS Compatible QSFP56 200GBASE-SR4 850nm 100m DOM MPO12/UPC MMF Optical Transceiver Module, Support 4 x 50G-SR - FS.com</p> <p>Dell R750 : F5 Networks F5-UPG-QSFP28-SR4 Compatible QSFP28 100GBASE-SR4 850nm \\ 100m DOM MPO-12/UPC MMF Optical Transceiver Module, Support 4 x 25G-SR - FS.com</p>"},{"location":"prereq/#gpu-optional","title":"GPU (Optional)","text":"<p>HGX = Nvidia H100 (x86)</p> <p>MGX = NVIDIA GH200 (arm64)</p>"},{"location":"prereq/#dpu","title":"DPU","text":"<p>Model : B3220 Single-Slot FHHL w/ Crypto enabled</p> <p>NVIDIA OPN : 900-9D3B6-00CV-AA0</p> <p>PSID : MT_0000000884</p>"}]}