<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../install-bnk/ rel=prev><link href=../bnk-ingress/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.21"><title>5. F5 BNK Configuration - BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU</title><link rel=stylesheet href=../assets/stylesheets/main.2a3383ac.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/print-site.css><link rel=stylesheet href=../css/print-site-material.css><link rel=stylesheet href=../css/timeago.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#lab-configuration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU" class="md-header__button md-logo" aria-label="BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 5. F5 BNK Configuration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=blue-grey aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/f5devcentral/f5-bnk-nvidia-bf3-installations title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m504 204.6-.7-1.8L433.6 21c-1.4-3.6-3.9-6.6-7.2-8.6-2.4-1.6-5.1-2.5-8-2.8s-5.7.1-8.4 1.1-5.1 2.7-7.1 4.8c-1.9 2.1-3.3 4.7-4.1 7.4l-47 144H161.3l-47.1-144c-.8-2.8-2.2-5.3-4.1-7.4-2-2.1-4.4-3.7-7.1-4.8-2.6-1-5.5-1.4-8.4-1.1s-5.6 1.2-8 2.8c-3.2 2-5.8 5.1-7.2 8.6L9.8 202.8l-.8 1.8c-10 26.2-11.3 55-3.5 82 7.7 26.9 24 50.7 46.4 67.6l.3.2.6.4 106 79.5c38.5 29.1 66.7 50.3 84.6 63.9 3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3c17.9-13.5 46.1-34.9 84.6-63.9l106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg> </div> <div class=md-source__repository> f5devcentral/f5-bnk-nvidia-bf3-installations </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU" class="md-nav__button md-logo" aria-label="BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> BIG-IP Next for Kubernetes on Nvidia BlueField-3 DPU </label> <div class=md-nav__source> <a href=https://github.com/f5devcentral/f5-bnk-nvidia-bf3-installations title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m504 204.6-.7-1.8L433.6 21c-1.4-3.6-3.9-6.6-7.2-8.6-2.4-1.6-5.1-2.5-8-2.8s-5.7.1-8.4 1.1-5.1 2.7-7.1 4.8c-1.9 2.1-3.3 4.7-4.1 7.4l-47 144H161.3l-47.1-144c-.8-2.8-2.2-5.3-4.1-7.4-2-2.1-4.4-3.7-7.1-4.8-2.6-1-5.5-1.4-8.4-1.1s-5.6 1.2-8 2.8c-3.2 2-5.8 5.1-7.2 8.6L9.8 202.8l-.8 1.8c-10 26.2-11.3 55-3.5 82 7.7 26.9 24 50.7 46.4 67.6l.3.2.6.4 106 79.5c38.5 29.1 66.7 50.3 84.6 63.9 3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3c17.9-13.5 46.1-34.9 84.6-63.9l106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg> </div> <div class=md-source__repository> f5devcentral/f5-bnk-nvidia-bf3-installations </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../prereq/ class=md-nav__link> <span class=md-ellipsis> 1. Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=../install-host/ class=md-nav__link> <span class=md-ellipsis> 2. Kubernetes Setup </span> </a> </li> <li class=md-nav__item> <a href=../install-dpu/ class=md-nav__link> <span class=md-ellipsis> 3. DPU Setup </span> </a> </li> <li class=md-nav__item> <a href=../install-bnk/ class=md-nav__link> <span class=md-ellipsis> 4. F5 BNK Install </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 5. F5 BNK Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 5. F5 BNK Configuration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#configure-the-underlay-network class=md-nav__link> <span class=md-ellipsis> Configure the Underlay Network </span> </a> </li> <li class=md-nav__item> <a href=#configure-calico-cni-to-allow-vxlan-from-bnk class=md-nav__link> <span class=md-ellipsis> Configure Calico CNI to allow VXLAN from BNK </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../bnk-ingress/ class=md-nav__link> <span class=md-ellipsis> 6. F5 BNK Ingress Configuration </span> </a> </li> <li class=md-nav__item> <a href=../bnk-egress/ class=md-nav__link> <span class=md-ellipsis> 7. F5 BNK Egress Configuration </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#configure-the-underlay-network class=md-nav__link> <span class=md-ellipsis> Configure the Underlay Network </span> </a> </li> <li class=md-nav__item> <a href=#configure-calico-cni-to-allow-vxlan-from-bnk class=md-nav__link> <span class=md-ellipsis> Configure Calico CNI to allow VXLAN from BNK </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=../assets/pdf/bnk_lab_guide.pdf title="Site PDF" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-9.5 8.5c0 .8-.7 1.5-1.5 1.5H7v2H5.5V9H8c.8 0 1.5.7 1.5 1.5zm5 2c0 .8-.7 1.5-1.5 1.5h-2.5V9H13c.8 0 1.5.7 1.5 1.5zm4-3H17v1h1.5V13H17v2h-1.5V9h3zm-6.5 0h1v3h-1zm-5 0h1v1H7z"/></svg> </a> <a href=https://github.com/f5devcentral/f5-bnk-nvidia-bf3-installations/edit/main/docs/configure-bnk.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/f5devcentral/f5-bnk-nvidia-bf3-installations/raw/main/docs/configure-bnk.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=lab-configuration>Lab Configuration<a class=headerlink href=#lab-configuration title="Permanent link">&para;</a></h1> <p>The BIG-IP Next for Kubernetes dataplane component (<abbr title="F5 Traffic Management Microkernel">TMM</abbr>) executes all networking stack operations entirely in user space and connects to Scalable Function (SF) interfaces using the DPDK driver. The <abbr title="F5 Traffic Management Microkernel">TMM</abbr>'s networking configuration is managed through Custom Resources (CRs), and we will utilize these resources to set up the installation as outlined in the lab diagram. <img alt="BNK on DPU Lab Diagram" src=../assets/images/bnk_lab_diagram.png></p> <h2 id=configure-the-underlay-network>Configure the Underlay Network<a class=headerlink href=#configure-the-underlay-network title="Permanent link">&para;</a></h2> <p>The underlay network consists of IP addresses directly connected to the physical network segments or infrastructure. These addresses are configured using the <code>F5SPKVlan</code> Custom Resource (<abbr title="Kubernetes Custom Resource">CR</abbr>).</p> <p>The <code>F5SPKVlan</code> resources below configure two <strong>untagged VLANs</strong>: - <strong>internal</strong>: Connected to the internal network segment. - <strong>external</strong>: Connected to the external network segment.</p> <p>The IPv4 and IPv6 address lists specify the <strong>underlay IP addresses</strong> reachable through these network segments. Each address from the list is assigned to one instance of <abbr title="F5 Traffic Management Microkernel">TMM</abbr>. The addresses list must include enough IP addresses enough for the number of <abbr title="F5 Traffic Management Microkernel">TMM</abbr> instances planned. For example if we have 3 <abbr title="Nvidia BlueField Data Processing Unit">DPU</abbr> nodes, we require <strong>at least three IP addresses in the list</strong>.</p> <div class="admonition example"> <p class=admonition-title>Example</p> <p>For example, if there are 3 <abbr title="Nvidia BlueField Data Processing Unit">DPU</abbr> nodes in the deployment, you will need at least three IP addresses in the list.</p> </div> <p>To apply this configuration, download, modify if needed, and apply the VLAN configuration file: <a href=../assets/config/bnk-vlans.yaml>bnk-vlans.yaml</a>.</p> <details class=note> <summary>Show content of bnk-vlans.yaml</summary> <div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.f5net.com/v1&quot;</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">F5SPKVlan</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">internal</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">internal</span>
<span class=w>  </span><span class=nt>interfaces</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;1.2&quot;</span>
<span class=w>  </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class=w>  </span><span class=nt>selfip_v4s</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.20.201</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.20.202</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.20.203</span>
<span class=w>  </span><span class=nt>prefixlen_v4</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
<span class=w>  </span><span class=nt>selfip_v6s</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2001::192:168:20:201</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2001::192:168:20:202</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2001::192:168:20:203</span>
<span class=w>  </span><span class=nt>prefixlen_v6</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">112</span>
<span class=w>  </span><span class=nt>auto_lasthop</span><span class=p>:</span><span class=w> </span><span class=s>&quot;AUTO_LASTHOP_ENABLED&quot;</span>
<span class=w>  </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.f5net.com/v1&quot;</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">F5SPKVlan</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">external</span>
<span class=w>  </span><span class=nt>interfaces</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;1.1&quot;</span>
<span class=w>  </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class=w>  </span><span class=nt>selfip_v4s</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.10.201</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.10.202</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.10.203</span>
<span class=w>  </span><span class=nt>prefixlen_v4</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
<span class=w>  </span><span class=nt>selfip_v6s</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2001::192:168:10:201</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2001::192:168:10:202</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2001::192:168:10:203</span>
<span class=w>  </span><span class=nt>prefixlen_v6</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">112</span>
<span class=w>  </span><span class=nt>auto_lasthop</span><span class=p>:</span><span class=w> </span><span class=s>&quot;AUTO_LASTHOP_ENABLED&quot;</span>
</code></pre></div> </details> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>A VLAN tag value of <code>0</code> (<code>tag: 0</code>) indicates an <strong>untagged VLAN</strong>. If tagging is required, replace <code>0</code> with the desired VLAN tag.</li> <li>Each interface can have <strong>only one untagged VLAN</strong>, while <strong>multiple tagged VLANs</strong> are allowed per interface.</li> <li>VLAN tags must be <strong>unique across all interfaces</strong>. The same VLAN tag cannot be assigned to more than one interface.</li> </ul> </div> <p>When network interfaces, such as <strong>Scalable Functions (SFs)</strong>, are connected to <abbr title="F5 Traffic Management Microkernel">TMM</abbr> (via the <strong>Network Attachment Definition</strong>), they are assigned <strong>index numbers</strong> based on the order in which they are configured. For example, interfaces are indexed as <code>1.1</code>, <code>1.2</code>, and so forth. In the <code>F5SPKVlan</code> configuration shown above, note the <code>interfaces</code> section referencing <code>1.1</code> and <code>1.2</code>.</p> <div class="admonition note"> <p class=admonition-title><strong>Mapping Interfaces in This Lab Guide</strong></p> <p>This description provides a simplified overview of interface naming for clarity specific to this lab guide.</p> <ul> <li><strong>Network Attachments</strong>:<ul> <li>Configured with the names <code>sf-internal</code> and <code>sf-external</code>.</li> </ul> </li> <li><strong>Interface Mapping in <code>SPKInfrastructure</code> <abbr title="Kubernetes Custom Resource">CR</abbr></strong>:<ul> <li>The <code>SPKInfrastructure</code> Custom Resource connects these interfaces as follows: <div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span class=nt>networkAttachment</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default/sf-external</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default/sf-internal</span>
</code></pre></div> The order of the <code>networkAttachment</code> section determines the interface assignment:</li> <li><strong><code>sf-external</code></strong>: Assigned <code>1.1</code></li> <li><strong><code>sf-internal</code></strong>: Assigned <code>1.2</code></li> </ul> </li> </ul> </div> <p>To verify the network configuration, check the status of the <code>F5SPKVlan</code> Custom Resources:</p> <div class="language-console highlight"><span class=filename>Bash Session</span><pre><span></span><code><span class=go>host# kubectl get f5-spk-vlan</span>
<span class=go>NAME       READY   MESSAGE                                AGE</span>
<span class=go>external   True    CR config sent to all grpc endpoints   30h</span>
<span class=go>internal   True    CR config sent to all grpc endpoints   30h</span>
</code></pre></div> <h2 id=configure-calico-cni-to-allow-vxlan-from-bnk>Configure Calico CNI to allow VXLAN from <abbr title="F5 BIG-IP Next for Kubernetes">BNK</abbr><a class=headerlink href=#configure-calico-cni-to-allow-vxlan-from-bnk title="Permanent link">&para;</a></h2> <p>In this lab we will build VXLAN networks between the host node and the <abbr title="F5 Traffic Management Microkernel">TMM</abbr> to segregate tenants based on namespaces. Calico CNI as installed and configured in this lab will create rules to deny VXLAN traffic from different external sources than node list, and thus we need to explicitly allow the <abbr title="F5 Traffic Management Microkernel">TMM</abbr> VXLAN traffic to pass through host node to workload.</p> <p>In order to achieve that we need to patch calico's felixconfiguration to allow <abbr title="F5 Traffic Management Microkernel">TMM</abbr>'s internal VLAN IP addresses.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Make sure the IP addresses match what is configured in the <code>F5SPKVlan</code> internal <abbr title="Kubernetes Custom Resource">CR</abbr>.</p> </div> <div class="language-console highlight"><span class=filename>Bash Session</span><pre><span></span><code><span class=go>host# kubectl patch felixconfiguration default --type=&#39;merge&#39; -p=&#39;{&quot;spec&quot;: {&quot;externalNodesList&quot;: [&quot;192.168.20.201&quot;, &quot;192.168.20.202&quot;, &quot;192.168.20.203&quot;]}}&#39;</span>
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="October 2, 2025 15:45:20 UTC"><span class=timeago datetime=2025-10-02T15:45:20+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="October 2, 2025 15:45:20 UTC">2025-10-02</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.sections", "content.code.select", "content.code.copy", "navigation.top", "content.action.view", "content.action.edit"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../js/print-site.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>